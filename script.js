// --- VARIÁVEIS GLOBAIS E DE LÓGICA ---
let pontuacaoEstilos = {};
let respostasPorPergunta = {};
let estilosPrimarioSecundario = { primary: null, secondary: null, tertiary: null };
let perguntaAtualIndice = -1;
let faseAtual = 1;


// --- DADOS DA LOGO (SUBSTITUA PELO SEU CÓDIGO BASE64 REAL) ---
// Converta sua logo (PNG ou JPG) para Base64 usando uma ferramenta online.
// Ex: https://base64.guru/converter/image
// A string deve começar com 'data:image/png;base64,...' ou 'data:image/jpeg;base64,...'
const LOGO_BASE64 = 'data:image/png;base64,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'; // <<<<< SUBSTITUA ESTE VALOR PELO BASE64 DA SUA LOGO REAL >>>>>

let LOGO_DESIRED_WIDTH_MM = 50; // Largura desejada da logo no PDF em mm
let LOGO_CALCULATED_HEIGHT_MM = 0; // Altura será calculada dinamicamente
const LOGO_X_MM = (210 - LOGO_DESIRED_WIDTH_MM) / 2; // Centraliza a logo na página A4 (210mm de largura)
const LOGO_Y_MM = 10; // Margem superior (em mm)


    // Função para carregar a logo e calcular suas dimensões proporcionais
    async function calculateLogoDimensions() {
        return new Promise((resolve) => {
            if (!LOGO_BASE64 || !LOGO_BASE64.startsWith('data:image')) {
                console.warn('LOGO_BASE64 não definida ou inválida. Não foi possível calcular dimensões da logo. Usando fallback.');
                LOGO_CALCULATED_HEIGHT_MM = 20; // Fallback
                resolve();
                return;
            }
            const img = new Image();
            img.onload = () => {
                const aspectRatio = img.naturalWidth / img.naturalHeight;
                LOGO_CALCULATED_HEIGHT_MM = LOGO_DESIRED_WIDTH_MM / aspectRatio;
                resolve();
            };
            img.onerror = () => {
                console.error('Erro ao carregar logo para cálculo de dimensões. Usando fallback.');
                LOGO_CALCULATED_HEIGHT_MM = 15; // Fallback
                resolve();
            };
            img.src = LOGO_BASE64;
        });
    }

    // Função para formatar a data e hora para AAAA-MM-DD HH:MM:SS (ideal para planilha)
    function formatDateTimeForSheets(dateObj) {
        const year = dateObj.getFullYear();
        const month = String(dateObj.getMonth() + 1).padStart(2, '0'); // Mês é 0-indexado
        const day = String(dateObj.getDate()).padStart(2, '0');
        const hours = String(dateObj.getHours()).padStart(2, '0');
        const minutes = String(dateObj.getMinutes()).padStart(2, '0');
        const seconds = String(dateObj.getSeconds()).padStart(2, '0');

        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }

    // Função para formatar a data para DDMMAA
    function getFormattedDateDDMMAA(dateObj) {
        const day = String(dateObj.getDate()).padStart(2, '0');
        const month = String(dateObj.getMonth() + 1).padStart(2, '0'); // Mês é 0-indexado
        const year = String(dateObj.getFullYear()).slice(-2); // Pega os últimos 2 dígitos do ano (ex: 25 para 2025)
        return `${day}${month}${year}`;
    }

    // === FUNÇÃO ONCLONE ROBUSTA PARA SANITIZAR O HTML PARA HTML2CANVAS ===
    // Adaptada do seu script original para lidar com CSS complexo e ocultar elementos indesejados.
    const customHtml2CanvasOnClone = (clonedDoc, originalElement) => {
        try {
            if (!originalElement) {
                console.warn('onclone: elemento original (element) não encontrado — abortando sanitização do clone.');
                return;
            }
            const originals = originalElement.querySelectorAll('*');
            const clones = clonedDoc.querySelectorAll('*');

            const len = Math.min(originals.length, clones.length);
            for (let i = 0; i < len; i++) {
                const o = originals[i];
                const c = clones[i];
                if (!o || !c) continue;

                const cs = window.getComputedStyle(o);

                // Preserve font-related properties e text-transform (corrige texto minúsculo no canvas)
                try {
                    if (cs.fontFamily) c.style.fontFamily = cs.fontFamily;
                    if (cs.fontWeight) c.style.fontWeight = cs.fontWeight;
                    if (cs.fontStyle) c.style.fontStyle = cs.fontStyle;
                    if (cs.fontSize) c.style.fontSize = cs.fontSize;
                    if (cs.lineHeight) c.style.lineHeight = cs.lineHeight;
                    if (cs.letterSpacing) c.style.letterSpacing = cs.letterSpacing;
                    if (cs.wordSpacing) c.style.wordSpacing = cs.wordSpacing;
                    if (cs.textTransform) c.style.textTransform = cs.textTransform;
                } catch(e) { /* ignore errors copying computed styles */ }


                // Força cores e fundos seguros para evitar erros de html2canvas com funções modernas
                if (cs.color) c.style.color = cs.color;
                if (cs.backgroundColor && cs.backgroundColor !== 'rgba(0, 0, 0, 0)') {
                    c.style.backgroundColor = cs.backgroundColor;
                } else {
                    c.style.backgroundColor = '#ffffff'; // Fundo branco padrão
                }

                // Remove imagens de fundo, sombras e filtros que causam problemas de renderização
                c.style.backgroundImage = 'none';
                c.style.boxShadow = 'none';
                if (cs.borderColor) c.style.borderColor = cs.borderColor;
                c.style.filter = 'none';
                c.style.backdropFilter = 'none';

                // Limpa estilos inline que podem conter funções de cor modernas
                const inline = c.getAttribute && c.getAttribute('style');
                if (inline && /(?:color-mix|color\(|lab\(|lch\()/i.test(inline)) {
                    try {
                        c.setAttribute('style', inline.replace(/(?:color-mix\([^\)]*\)|color\([^\)]*\)|lab\([^\)]*\)|lch\([^\)]*\))/gi, ''));
                    } catch (e) { /* ignorar falhas por elemento */ }
                }
            }

            // Limpa <style> tags dentro do documento clonado
            const styleTags = clonedDoc.querySelectorAll('style');
            styleTags.forEach(st => {
                try {
                    st.textContent = st.textContent
                        .replace(/(?:color-mix\([^\)]*\)|color\([^\)]*\)|lab\([^\)]*\)|lch\([^\)]*\))/gi, '')
                        .replace(/page-break-(after|before):\s*always;?/gi, '')
                        .replace(/break-(after|before):\s*page;?/gi, '')
                        .replace(/@page[^{]*{[^}]*}/gi, '')
                        .replace(/break-inside:\s*avoid;?/gi, '')
                        .replace(/orphans:\s*\d+;?/gi, '')
                        .replace(/widows:\s*\d+;?/gi, '');
                } catch (e) { /* ignorar */ }
            });

            // Ajusta stylesheets externos para não causarem problemas
            const head = clonedDoc.querySelector('head');
            if (head) {
                head.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
                    try {
                        const href = link.getAttribute('href') || '';
                        if (/fonts\.googleapis|fonts\.gstatic|\.woff2?|\.ttf|\.otf/i.test(href)) {
                            return; // Mantém links de fontes
                        }
                        try {
                            link.media = 'print'; // Reduz impacto de outros estilos
                        } catch (e) {
                            link.remove(); // Se não puder ajustar, remove
                        }
                    } catch (e) { /* ignorar */ }
                });
            }
            
            // === MUITO IMPORTANTE: OCULTA BOTÕES E CONTROLES DE EXPORTAÇÃO DO CLONE ===
            // Adicionei mais seletores para cobrir uma gama maior de botões e elementos interativos.
            const hideSelectors = [
            'button', 'input[type="button"]', 'input[type="submit"]', 'input[type="image"]', 
            '.btn', '.no-print', '.controls', '.footer', '.footer-controls', '.acoes',
            '#btn-download-pdf', '#download-pdf', '.result-export-controls', '#btnGenerateAndSend',
            '.download-btn', '.export-button', '.action-button', 
            'a[href*="download"]', 
            'img[alt*="download"]', 'img[src*="download"]', 
            'img[alt*="pdf"]', 'img[src*="pdf"]', 
            'img[alt*="button"]', 'img[src*="button"]', 
            ];
            hideSelectors.forEach(sel => {
                try {
                    clonedDoc.querySelectorAll(sel).forEach(n => n.remove());
                } catch (e) { /* ignorar */ }
            });

            // Injeta estilos de segurança para PDF no clone
            // word-spacing: normal !important; 

            try {
                const safetyStyle = clonedDoc.createElement('style');
                safetyStyle.textContent = `
                html, body { height: auto !important; overflow: visible !important; margin: 0; padding: 0 !important; }
                body { font-family: Arial, sans-serif !important; font-size: 9.5px !important; line-height: 1.15 !important; color: #000 !important; background-color: #fff !important; } /* Base font size 9.5px, line-height 1.15 */

                // Incluindo h3 no seletor para garantir que o título "Diagnóstico de estilo finalizado" seja afetado
                // Definindo white-space: normal para que as palavras quebrem naturalmente
                // Adicionando word-break para forçar quebras em palavras muito longas e hyphens para hifenização                
                
                h1, h2, .final-title, .diagnostico-title { 
                    text-align: center !important; 
                    font-size: 14px !important; 
                    font-weight: bold !important; 
                    margin-bottom: 3px !important; 
                    margin-top: 8px !important; 
                    letter-spacing: normal !important; 
                    word-spacing: normal !important; 
                    white-space: normal !important; 
                    word-spacing: white-space: normal !important;

                    white-space: normal !important; // <-- ALTERADO de 'pre-wrap' (removido duplicado abaixo)
                    word-break: break-word !important; // <-- ADICIONADO para melhor quebra
                    hyphens: auto !important; // <-- ADICIONADO para hifenização
                } 
                h3, h4 { font-size: 11px !important; margin-top: 6px !important; margin-bottom: 2px !important; font-weight: bold !important; text-align: center !important; } /* Subtítulos 11px */
                p, ul, ol, div { page-break-inside: avoid !important; break-inside: avoid !important; font-size: 9.5px !important; line-height: 1.15 !important; margin-bottom: 2px !important; } /* Parágrafos e divs 9.5px */
                .style-description { font-size: 9.5px !important; line-height: 1.25 !important; margin-bottom: 2px !important;} /* Descrição do estilo 9.5px */
                img { max-width: 100% !important; height: auto !important; display: block !important; margin-left: auto !important; margin-right: auto !important; }
                .final-results-header p.lead { font-size: 11px !important; margin-bottom: 4px !important; }
                .final-call-to-action { font-size: 9.5px !important; margin-top: 8px !important; }
                
                /* Remover padding excessivo do container principal para minimizar margens */
                #final-resultado { padding: 3mm !important; box-sizing: border-box !important; } /* Padding reduzido para 3mm */
                
                /* Remover margens e padding de *todos* os elementos para apertar o conteúdo */
                * { margin-top: 0 !important; margin-bottom: 0 !important; padding-top: 0 !important; padding-bottom: 0 !important; }
                .page-content-wrapper, .content-box, .section-content { padding: 0 !important; margin: 0 !important; }
                .section { margin-bottom: 5px !important; } /* Pequena margem entre seções */
                
                /* As regras de espaçamento e white-space para títulos já foram unificadas e corrigidas acima. */
                // A LINHA ABAIXO FOI REMOVIDA PARA EVITAR CONFLITO E DUPLICAÇÃO DA REGRA white-space: pre-wrap:
                // .final-title, .diagnostico-title, h1, h2 { white-space: pre-wrap !important; }
            `;
            if (head) head.appendChild(safetyStyle);

                // ALTERAÇÃO 2025-09-26: desativa animações/transições no clone (previne mudanças dinâmicas durante o snapshot)
                try {
                    if (clonedDoc && clonedDoc.head && !clonedDoc.getElementById('ap-html2canvas-disable-anim')) {
                        const s = clonedDoc.createElement('style');
                        s.id = 'ap-html2canvas-disable-anim';
                        s.appendChild(clonedDoc.createTextNode(`
                            * { animation: none !important; transition: none !important; -webkit-animation: none !important; -webkit-transition: none !important; }
                            @media print { * { -webkit-print-color-adjust: exact !important; } }
                        `));
                        clonedDoc.head.appendChild(s);
                    }
                } catch(e) { /* ignora */ }
                
                const clonedHtml = clonedDoc.querySelector('html');
                const clonedBody = clonedDoc.querySelector('body');
                if (clonedHtml) { clonedHtml.style.backgroundImage = 'none'; clonedHtml.style.backgroundColor = '#ffffff'; clonedHtml.style.height = 'auto'; }
                if (clonedBody) { clonedBody.style.backgroundImage = 'none'; clonedBody.style.backgroundColor = '#ffffff'; clonedBody.style.height = 'auto'; clonedBody.style.paddingBottom = '0px'; clonedBody.style.overflow = 'visible'; }

            } catch (e) {
                console.warn('onclone sanitization error (safety styles):', e);
            }
        } catch (e) {
            console.warn('onclone sanitization error (main):', e);
        }
    };

    async function loadScriptOnce(url, id) {
        if (id && document.getElementById(id)) return; // já carregado
        return new Promise((resolve, reject) => {
            const s = document.createElement('script');
            if (id) s.id = id;
            s.src = url;
            s.async = false; // manter ordem previsível
            s.onload = () => resolve();
            s.onerror = (e) => reject(new Error('Failed to load script ' + url));
            document.head.appendChild(s);
        });
    }

    async function ensureHtml2pdf() {
        if (window.html2pdf && typeof window.html2pdf === 'function') return;

        // tenta carregar versão conhecida compatível
        const cdn = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
            
        try {
            await loadScriptOnce(cdn, 'html2pdf-lib');
            // aguarda microtick para garantir binding global
            await new Promise(r => setTimeout(r, 40));
            if (window.html2pdf && typeof window.html2pdf === 'function') return;
            throw new Error('html2pdf carregado mas não expõe função global html2pdf');
        } catch (err) {
            // fallback: tenta versão anterior sem bloqueio de integrity
            const fallback = 'https://unpkg.com/html2pdf.js@0.9.2/dist/html2pdf.bundle.js';
            try {
            await loadScriptOnce(fallback, 'html2pdf-fallback');
            await new Promise(r => setTimeout(r, 40));
            if (window.html2pdf && typeof window.html2pdf === 'function') return;
            throw new Error('fallback carregado mas html2pdf não disponível');
            } catch (err2) {
            // Erro definitivo
            throw new Error('Não foi possível carregar html2pdf. Verifique conexão/CDN. ' + err2.message);
            }
        }
    }
    /* ======================================================= */

    const totalPerguntas = 35;
    const todosOsEstilos = ["clássica", "tradicional", "dramática", "romântica", "sensual (sexy)", "criativa", "básica"];
    const labelsOpcoes = ["A", "B", "C", "D", "E", "F", "G"];
    let todasAsPerguntas = [];
    let phaseResultModal;

    // Guarda, para cada fase, o mapa de pontuações antes do reset
    const faseCounts = {
        1: {},
        2: {},
        3: {}
    };

    // Mapeamentos
    const imagemRanges = { 15: [3, 9], 16: [11, 17], 17: [19, 25], 18: [27, 33], 19: [35, 41], 20: [43, 49], 21: [51, 57], 22: [59, 65], 23: [67, 73], 24: [75, 81], 25: [83, 89], 26: [91, 97], 27: [99, 105], 28: [107, 113], 29: [115, 121], 30: [123, 129], 31: [131, 137], 32: [139, 145], 33: [147, 153], 34: [155, 161], 35: [163, 169] };
    const detalhesEstiloMapCompleto = { "clássica": "Você é elegante, refinada e feminina, prezando por acabamentos impecáveis e atemporalidade. Seu estilo é sofisticado, discreto, e você gosta de se enfeitar, encontrando prazer em combinar peças clássicas com detalhes que revelam uma sofisticação natural.", "tradicional": "Você é elegante, refinada e prática, valorizando a funcionalidade acima de tudo. Gosta de estar bem vestida com peças atemporais, clássicas e sóbrias, sem precisar dedicar muito tempo a isso. Discrição e eficiência são a sua marca.", "dramática": "Você é elegante, moderna e poderosa, buscando impacto sem dizer uma palavra. Adora misturar elementos diferentes para criar contrapontos, com roupas clássicas que possuem toques modernos, cores e elementos marcantes, sempre em busca de um visual interessante e contemporâneo.", "romântica": "Você é elegante, feminina e delicada, expressando leveza através das suas roupas. Prefere elementos femininos, como laços, pérolas e mangas bufantes, e se veste para realçar sua feminilidade de forma fofa e encantadora.", "sensual (sexy)": "Você é elegante, feminina e atraente, buscando se sentir poderosa e desejada. Suas roupas e acessórios valorizam seu corpo de forma elegante e magnética, mostrando o suficiente para ser atraente sem ser vulgar.", "criativa": "Você é elegante, moderna e fashionista, adorando ousar e brincar com combinações inusitadas. Acompanha tendências e usa a moda como forma de expressar sua criatividade e personalidade única, sem medo de experimentar e de se destacar.", "básica": "Você é elegante, prática e natural, priorizando o conforto e a discrição. Ama roupas confortáveis, fáceis de combinar e que não chamem muita atenção, evitando formalidade excessiva e prezando por um estilo simples, chique e sem frescura." };
    const ordemDesempate = [15, 21, 29, 33, 34, 35, 32, 31, 28, 25, 20, 19, 18, 17];

    // --- Conteúdo das páginas de introdução (Exatamente como no documento original) ---
    const introPages = [
        { 
            id: "intro-page-1", 
            title:"", 
            content: `
                <p>Seja bem-vinda ao nosso teste de estilos! Aqui você responderá a uma série de perguntas que foram cuidadosamente formuladas por mim, Marina, juntamente a uma equipe de consultoras e psicopedagogas. Este teste segue a metodologia Armário Perfeito de Consultoria de Imagem, método desenvolvido por mim e validado pelo MEC.</p>
                <p>Dentro do método AP, cada mulher possui 3 estilos predominantes: sendo um estilo primário, que é a sua identidade principal, seguido do estilo secundário e terciário.</p>
                <p>Vamos descobrir cada um deles e para isso o teste será dividido em <strong>3 etapas:</strong></p>
                <ol>
                    <li> a descoberta do estilo <strong>primário</strong></li>
                    <li> a descoberta do estilo <strong>secundário</strong></li>
                    <li> a descoberta do estilo <strong>terciário</strong></li>
                </ol>
                <p>Propositalmente, as perguntas se repetirão a cada etapa.</p>
                <p>Vamos começar? Separe <strong>30 minutos</strong> para responder!</p>
            ` 
        }
    ];
    
    let currentIntroPageIndex = 0;

    function initQuiz() {
        phaseResultModal = new bootstrap.Modal(document.getElementById('phase-result-modal'));
        document.getElementById('quiz-section').style.display = 'none';
        document.getElementById('final-resultado').style.display = 'none';
        showIntroPage();
        window.scrollTo(0, 0); // Para garantir que a página role para o topo ao iniciar
    }

    function showIntroPage() {
        const introSection = document.getElementById('intro-section');

        introSection.innerHTML = `
        <div class="intro-page card p-4 shadow-sm active">
            ${currentIntroPageIndex === 0 ? `
                <h1 class="display-4 fw-bold mb-3">Descubra seu estilo!</h1>
                
            ` : ''}
            <h3 class="card-title text-center mb-3 text-primary">${introPages[currentIntroPageIndex].title}</h3>
            <div class="card-text">${introPages[currentIntroPageIndex].content}</div>
            <div class="navigation-buttons">
                ${currentIntroPageIndex > 0 ? '<button class="btn btn-outline-secondary" onclick="prevIntroPage()">Voltar</button>' : ''}
                <button class="btn btn-primary" onclick="nextIntroPage()">${currentIntroPageIndex < introPages.length - 1 ? 'Próximo' : 'Começar Teste'}</button>
            </div>
        </div>
        `;
        
        introSection.style.display = 'block';
    }

    function nextIntroPage() {
        document.getElementById('intro-section').classList.add('fade-out-section');
        setTimeout(() => {
            document.getElementById('intro-section').style.display = 'none';
            startQuiz();
        }, 500);
    }

    function prevIntroPage() { if (currentIntroPageIndex > 0) { currentIntroPageIndex--; showIntroPage(); } }
    
    function startQuiz() {
        document.getElementById('quiz-section').style.display = 'block';
     
        // Esconde o resultado final caso tenha ficado exposto de execuções anteriores
        document.getElementById('final-resultado').style.display = 'none';


        loadAllQuestions();
        // todasAsPerguntas = shuffle([...todasAsPerguntas]); // embaralha mantendo os numeros originais

        // separa textuais e imagéticas
        const textQuestions  = todasAsPerguntas.filter(q => q.tipo === 'text');
        const imageQuestions = todasAsPerguntas.filter(q => q.tipo === 'image');

        // embaralha somente as opções das perguntas de texto
        textQuestions.forEach(q => {
        q.opcoes = shuffle([...q.opcoes]);
        });

        // mantém as perguntas na ordem: todas de texto primeiro, depois as de imagem
        todasAsPerguntas = [...textQuestions, ...imageQuestions];
            
        resetPontuacao();
        perguntaAtualIndice = 0;
        renderQuestion();
    }
    
    function resetPontuacao() { todosOsEstilos.forEach(estilo => { pontuacaoEstilos[estilo] = 0; }); }

    function renderQuestion() {   
        const quizSection = document.getElementById('quiz-section');
        quizSection.innerHTML = '';
        
        // Se acabar as perguntas, mostra os resultados da fase
        if (perguntaAtualIndice >= totalPerguntas) {
            processPhaseResults();
            return;
        }

        // Pega a pergunta atual (já embaralhada)
        const pergunta = todasAsPerguntas[perguntaAtualIndice];

        // Cria o card da pergunta
        const perguntaDiv = document.createElement('div');
        perguntaDiv.className = 'pergunta-container active card p-4 shadow-sm mb-4';

        // Calcula número para exibição na ordem aleatória
        const numeroExibicao = perguntaAtualIndice + 1;

        // Monta o HTML completo da pergunta
        /* perguntaDiv.innerHTML = `
            <p class="lead text-center">
                <strong>Pergunta ${numeroExibicao} de ${totalPerguntas} (Fase ${faseAtual})</strong>
            </p>
        <p class="text-center h5">${pergunta.texto}</p>
        <div class="row justify-content-center mt-3" id="opcoes-pergunta-${pergunta.numero}"></div>
        <div class="navigation-buttons">
            <button id="btn-proxima"
                class="btn btn-primary btn-lg"
                onclick="avancarParaProximaPergunta()"
                disabled>
              Próxima Pergunta
           </button>
        </div>
        `; */

        perguntaDiv.innerHTML = `
            <p class="lead text-center">
                <strong>Pergunta ${numeroExibicao} de ${totalPerguntas} (Fase ${faseAtual})</strong>
            </p>
            <p class="text-center h5">${pergunta.texto}</p>
            
            <div class="row justify-content-center mt-3" id="opcoes-pergunta-${pergunta.numero}"></div>
            
            <div class="navigation-buttons d-flex justify-content-between">
                <button id="btn-voltar"
                    class="btn btn-outline-secondary btn-lg"
                    onclick="voltarPergunta()"
                    ${perguntaAtualIndice === 0 ? 'disabled' : ''}> Voltar
                </button>
                <button id="btn-proxima"
                    class="btn btn-primary btn-lg"
                    onclick="avancarParaProximaPergunta()"
                    disabled>
                    Próxima Pergunta
                </button>
            </div>
        `;

        // Adiciona ao DOM
        quizSection.appendChild(perguntaDiv);
        
        /* ALTERADO 30/07 */ 
        perguntaDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Pega o container das opções e aplica classe de fase

        const opcoesContainer = document.getElementById(`opcoes-pergunta-${pergunta.numero}`);
        opcoesContainer.classList.add(`phase-${faseAtual}`);
        
        // Renderiza cada opção (texto ou imagem)
        let hasRenderableOptions = false;
        let currentVisualLabelIndex = 0;
        pergunta.opcoes.forEach(opcao => {
            const isEstiloOculto = 
                (faseAtual === 2 && estilosPrimarioSecundario.primary === opcao.estilo) || 
                (faseAtual === 3 && (
                    estilosPrimarioSecundario.primary === opcao.estilo || 
                    estilosPrimarioSecundario.secondary === opcao.estilo
                    )
                );
            if (!isEstiloOculto) {
                hasRenderableOptions = true;
                const visualLabel = labelsOpcoes[currentVisualLabelIndex++];
                const colDiv = document.createElement('div');
                colDiv.className = pergunta.tipo === 'text' ? 'col-12' : 'col-lg-4 col-md-6';
            
                if (pergunta.tipo === 'text') {
                    colDiv.innerHTML = `
                        <div class="d-grid gap-2">
                            <label class="btn btn-outline-primary mb-2 py-3 text-start">
                                <input type="radio" 
                                       class="d-none" 
                                       name="pergunta-${pergunta.numero}" 
                                       value="${opcao.label}" 
                                       data-estilo="${opcao.estilo}"> 
                                <strong>${visualLabel}.</strong> ${opcao.textExibicao}
                            </label>
                        </div>
                    `;
                } else {
                    colDiv.innerHTML = `
                        <div class="text-center mb-3">
                            <label class="d-block">
                                <input type="radio" 
                                    class="d-none" 
                                    name="pergunta-${pergunta.numero}" 
                                    value="${opcao.label}" 
                                    data-estilo="${opcao.estilo}">
                                <img src="${opcao.image}" class="quiz-img" alt="Opção ${visualLabel}">
                                <p class="text-muted mt-2 fw-bold">${visualLabel}</p>
                            </label>
                        </div>
                    `;
                }
                opcoesContainer.appendChild(colDiv);
            }
        });
    
        document.querySelectorAll(`input[name="pergunta-${pergunta.numero}"]`).forEach(input => {
            input.addEventListener('change', (event) => {
                handleAnswerSelection(pergunta.numero, event.target.dataset.estilo, event.target.value);
                if (pergunta.tipo === 'text') {
                    document.querySelectorAll(`input[name="pergunta-${pergunta.numero}"]`).forEach(radio => {
                        radio.parentElement.classList.remove('active', 'btn-primary');
                        radio.parentElement.classList.add('btn-outline-primary');
                    });
                    event.target.parentElement.classList.add('active', 'btn-primary');
                    event.target.parentElement.classList.remove('btn-outline-primary');
                } else {
                    document.querySelectorAll(`#opcoes-pergunta-${pergunta.numero} .quiz-img`).forEach(img => img.classList.remove('selected'));
                    event.target.nextElementSibling.classList.add('selected');
                }
            });
        });

        if (!hasRenderableOptions) {
            opcoesContainer.innerHTML = `<p class="text-center text-muted">Não há mais opções de estilo para esta fase. Avançando...</p>`;
            document.getElementById('btn-proxima').disabled = false;
        }

        if (perguntaDiv) { // Certifica-se de que a perguntaDiv existe
            // Delay curto para garantir que o evento de click / foco finalize antes do scroll.
            // Isso evita que o botão seja "desselecionado" pelo navegador enquanto ocorre o clique.
            setTimeout(() => {
                perguntaDiv.scrollIntoView({ block: "start", behavior: "smooth" });
            }, 80);
        }

    }

    function handleAnswerSelection(questionNumber, selectedStyle, selectedOptionLabel) {
        respostasPorPergunta[questionNumber] = { estilo: selectedStyle, label: selectedOptionLabel };
        document.getElementById('btn-proxima').disabled = false;
    }

    function avancarParaProximaPergunta() {
        const pergunta = todasAsPerguntas[perguntaAtualIndice];
        const resposta = respostasPorPergunta[pergunta.numero];
        if (resposta && resposta.estilo) {
            pontuacaoEstilos[resposta.estilo] = (pontuacaoEstilos[resposta.estilo] || 0) + 1;
        }
        perguntaAtualIndice++;
        renderQuestion();
    }

    function voltarPergunta() {
        if (perguntaAtualIndice > 0) {
            // Identifica a pergunta anterior
            const anterior = todasAsPerguntas[perguntaAtualIndice - 1];
            const respAntiga = respostasPorPergunta[anterior.numero];
            // Se havia resposta, remove o ponto
            if (respAntiga && respAntiga.estilo) {
                pontuacaoEstilos[respAntiga.estilo]--;
                delete respostasPorPergunta[anterior.numero];
            }
            perguntaAtualIndice--;
            renderQuestion();
            // Re-habilita “Próxima” se já tiver resposta nesta pergunta
            const respAtual = respostasPorPergunta[todasAsPerguntas[perguntaAtualIndice].numero];
            document.getElementById('btn-proxima').disabled = !respAtual;
        }
    }

    function processPhaseResults() {
       // passo 0: esconde e limpa o container FINAL em TODAS as fases
       const finalDiv = document.getElementById('final-resultado');
       finalDiv.style.display = 'none';
       finalDiv.classList.remove('show');
       finalDiv.innerHTML = '';

        // 1) Clone a pontuação desta fase
        faseCounts[faseAtual] = { ...pontuacaoEstilos };

        // 2) Determina o estilo vencedor desta fase
        let estilosExcluidos = [];
        if (faseAtual === 2) {
            estilosExcluidos = [estilosPrimarioSecundario.primary];
        } else if (faseAtual === 3) {
            estilosExcluidos = [
            estilosPrimarioSecundario.primary,
            estilosPrimarioSecundario.secondary
            ];
        }
        const estiloVencedorDaFase = getEstiloVencedor(pontuacaoEstilos, estilosExcluidos);

        // 3) Armazena o vencedor
        if (faseAtual === 1) {
            estilosPrimarioSecundario.primary = estiloVencedorDaFase;
        } else if (faseAtual === 2) {
            estilosPrimarioSecundario.secondary = estiloVencedorDaFase;
        } else {
            estilosPrimarioSecundario.tertiary = estiloVencedorDaFase;
        }

        console.log(`>>> Fase ${faseAtual} contagens:`, faseCounts[faseAtual]);
        console.log(
            `>>> Escolhido como ${
            faseAtual === 1
                ? 'primário'
                : faseAtual === 2
                ? 'secundário'
                : 'terciário'
            }:`,
            estiloVencedorDaFase
        );

        // 4) Só mostra modal de transição nas fases 1 e 2
        const modalTitle = document.getElementById('modalLabel');
        const modalBody  = document.getElementById('modalBody');
        const modalBtn   = document.getElementById('modal-continue-btn');

        if (faseAtual === 1) {
            modalTitle.textContent = 'FASE 2';
            modalBody.innerHTML = `
            Perfeito, com essas respostas já descobrimos o seu estilo primário. Na segunda fase vamos descobrir o seu estilo secundário.<br>
            Para isso, as perguntas da fase 1 se repetem, porém <strong>excluindo as que correspondem ao seu estilo primário</strong>.
            `;
            modalBtn.textContent = 'Ir para Fase 2';
            phaseResultModal.show();

        } else if (faseAtual === 2) {
            modalTitle.textContent = 'FASE 3';
            modalBody.innerHTML = `
            Estamos quase no fim, já identificamos seus estilos primário e secundário. 
            Agora vamos para a terceira (e última) fase do teste para descobrir o seu estilo terciário. 
            Lembrando, as perguntas das fases 1 e 2 se repetem, mas excluindo as que correspondem aos seus estilos primário e secundário. <br>
            <br>
            Vamos lá?
            `;
            modalBtn.textContent = 'Ir para Fase 3';
            phaseResultModal.show();

        } else {
            // 5) Somente na Fase 3 exibimos o resultado final
            console.log(">>> Chegou na Fase 3, exibindo resultado final");
            displayFinalResults();
        }
    }

    function proceedToNextStep() {

        // Oculta o resultado final entre fases
        document.getElementById('final-resultado').style.display = 'none';

        // Só chamados quando há modal. Aqui só avançamos fases 1 e 2.
        phaseResultModal.hide();
        faseAtual++;
        resetPontuacao();
        // todasAsPerguntas = shuffle([...todasAsPerguntas]); // nova ordem para a fase seguinte

        // agrupa e embaralha só opções de texto novamente
        const textQuestions  = todasAsPerguntas.filter(q => q.tipo === 'text');
        const imageQuestions = todasAsPerguntas.filter(q => q.tipo === 'image');
        textQuestions.forEach(q => {
          q.opcoes = shuffle([...q.opcoes]);
        });
        todasAsPerguntas = [...textQuestions, ...imageQuestions];

        perguntaAtualIndice = 0;
        renderQuestion();
    }
    function shuffle(array) {
        // perguntas exibidas em ordem aleatória
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    function displayFinalResults() {
        const finalDiv = document.getElementById('final-resultado');

        // 1) sair imediatamente se não for a fase 3
        if (faseAtual < 3) {
            finalDiv.style.display = 'none';
            return;
        }

        // — só chegamos aqui na fase 3, monta o HTML final —

        window.scrollTo(0, 0);
        document.getElementById('intro-section').style.display = 'none';
        document.getElementById('quiz-section').style.display  = 'none';

        const primary   = estilosPrimarioSecundario.primary   || 'NÃO DEFINIDO';
        const secondary = estilosPrimarioSecundario.secondary || 'NÃO DEFINIDO';
        const tertiary  = estilosPrimarioSecundario.tertiary  || 'NÃO DEFINIDO';

        const html = `
            <div class="final-results-header">
                <h3>Diagnóstico de estilo finalizado.</h3>
                <p class="text-center mb-1 lead">Parabéns! Os seus estilos são:</p>
                <p class="text-left mb-4">
                    <strong>Primário:</strong> ${primary.toUpperCase()}<br>
                    <strong>Secundário:</strong> ${secondary.toUpperCase()}<br>
                    <strong>Terciário:</strong> ${tertiary.toUpperCase()}
                </p>
            </div>

            <!-- BLOCO DO ESTILO PRIMÁRIO -->

            <div class="row justify-content-center">
                <div class="col-lg-8 mb-4">
                    <div class="style-result primary-style">
                        <h4><span class="style-icon">⭐</span>Estilo Primário</h4>
                        <span class="style-name">${primary.toUpperCase()}</span>
                        <p class="style-description">${detalhesEstiloMapCompleto[primary]}</p>
                    </div>
                </div>
            </div>

            <!-- BLOCOS DE SECUNDÁRIO E TERCIÁRIO -->

            <div class="row justify-content-center">
                <div class="col-lg-6 mb-4">
                    <div class="style-result secondary-style">
                        <h4><span class="style-icon">✨</span>Estilo Secundário</h4>
                        <span class="style-name">${secondary.toUpperCase()}</span>
                        <p class="style-description">${detalhesEstiloMapCompleto[secondary]}</p>
                    </div>
                </div>

                <div class="col-lg-6 mb-4">
                    <div class="style-result tertiary-style">
                        <h4><span class="style-icon">💫</span>Estilo Terciário</h4>
                        <span class="style-name">${tertiary.toUpperCase()}</span>
                         <p class="style-description">${detalhesEstiloMapCompleto[tertiary]}</p>
                    </div>
                </div>
            </div>

            <p class="final-call-to-action">
                Para entender todos os detalhes sobre eles e saber como aplicá-los
                no seu armário e na sua rotina, basta acessar os materiais
                de cada um deles que se encontram dentro da sessão inicial do nosso aplicativo!
            </p>
        `;

        // Limpa e exibe o resultado final
        finalDiv.innerHTML     = html;
        // Adiciona controles de exportação ao topo do resultado (botão imprimir/baixar PDF)
        finalDiv.innerHTML = `
            <div class="result-export-controls" style="display:flex;justify-content:flex-end;gap:12px;margin-bottom:14px;">
                <button id="btn-download-pdf" class="btn btn-outline-secondary" title="Baixar / Imprimir resultado">Baixar PDF</button>
            </div>
        ` + finalDiv.innerHTML;

        finalDiv.style.display = 'block';
        finalDiv.classList.add('show');
        
        // Delay curto para evitar conflitos com qualquer transição/fechamento de modal
        setTimeout(() => {
            finalDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 80);

        // liga o botão à coleta de nome/email + envio
        const pdfBtn = document.getElementById('btn-download-pdf');
        if (pdfBtn) {
            // remove listeners antigos (caso já tenham sido ligados em execuções anteriores)
            const clone = pdfBtn.cloneNode(true);
            pdfBtn.parentNode.replaceChild(clone, pdfBtn);
            clone.addEventListener('click', function (ev) {
                ev.preventDefault();
                ev.stopPropagation();   // evita que o listener global em document capture este clique - ADICIONADO 18/09
                openSendModalPrefill(); // abre modal para coletar nome/email antes de gerar o PDF
            });
        }
    }

    function getEstiloVencedor(pontuacoes, estilosExcluidos) {
        let maxPontos = -1;
        let vencedoresPotenciais = [];
        todosOsEstilos.forEach(estilo => {
            if (!estilosExcluidos.includes(estilo)) {
                const pontos = pontuacoes[estilo] || 0;
                if (pontos > maxPontos) {
                    maxPontos = pontos;
                    vencedoresPotenciais = [estilo];
                } else if (pontos === maxPontos && pontos > 0) {
                    vencedoresPotenciais.push(estilo);
                }
            }
        });
        if (vencedoresPotenciais.length === 1) return vencedoresPotenciais[0];
        if (vencedoresPotenciais.length > 1) return aplicarDesempate(vencedoresPotenciais, respostasPorPergunta, estilosExcluidos);
        // Fallback para caso não encontre nenhum vencedor potencial (todos excluídos ou 0 pontos)
        /* Adicione a linha abaixo (será a linha 460)  console.log("getEstiloVencedor: Retornando estilos:", { primary, secondary, tertiary });*/
        return todosOsEstilos.find(s => !estilosExcluidos.includes(s)) || todosOsEstilos[0]; 
    }

    function aplicarDesempate(estilosEmpatados, respostas, estilosExcluidos) {
        for (const qNum of ordemDesempate) {
            const respostaDaPergunta = respostas[qNum];
            if (respostaDaPergunta && estilosEmpatados.includes(respostaDaPergunta.estilo) && !estilosExcluidos.includes(respostaDaPergunta.estilo)) {
                return respostaDaPergunta.estilo;
            }
        }
        // Se o desempate não puder ser resolvido pelas perguntas específicas,
        // retorna o primeiro estilo empatado em ordem alfabética como fallback,
        // desde que não esteja na lista de excluídos.
        const sortedEmpatados = estilosEmpatados.sort();
        return sortedEmpatados.find(s => !estilosExcluidos.includes(s)) || sortedEmpatados[0];
    }

    function loadAllQuestions() {
        todasAsPerguntas = [
            { numero: 1, texto: "Como você gostaria de ser percebida ao entrar em um ambiente?", tipo: "text",
                opcoes: [
                    { label: "A", text: "Elegante, refinada e feminina", estilo: "clássica" },
                    { label: "B", text: "Elegante, refinada e prática", estilo: "tradicional" },
                    { label: "C", text: "Elegante, moderna e poderosa", estilo: "dramática" },
                    { label: "D", text: "Elegante, feminina e delicada", estilo: "romântica" },
                    { label: "E", text: "Elegante, feminina e atraente", estilo: "sensual (sexy)" },
                    { label: "F", text: "Elegante, moderna e fashionista", estilo: "criativa" },
                    { label: "G", text: "Elegante, prática e natural", estilo: "básica" }
                ]
            },
            { numero: 2, texto: "Qual, destas afirmações, mais combina com você?", tipo: "text",
                opcoes: [
                    { label: "A", text: `Gosto de sentir que estou sempre bem vestida e sofisticada.`, estilo: "clássica" },
                    { label: "B", text: `Gosto de sentir que estou sempre bem vestida mas antes, prezo pela funcionalidade.`, estilo: "tradicional" },
                    { label: "C", text: `Gosto de sentir que estou sempre bem vestida mas não gosto de me sentir "clássica demais”.`, estilo: "dramática" },
                    { label: "D", text: `Adoro me sentir feminina e mostrar delicadeza e leveza através das minhas roupas.`, estilo: "romântica" },
                    { label: "E", text: `Eu quero que minha roupa atraia olhares e mostre que sou uma mulher segura.`, estilo: "sensual (sexy)" },
                    { label: "F", text: `Adoro ser a pessoa mais estilosa do lugar, amo acompanhar tendências!`, estilo: "criativa" },
                    { label: "G", text: `Não gosto de chamar atenção, prefiro estar discreta, isso me deixa mais à vontade.`, estilo: "básica" }
                ]
            },
            { numero: 3, texto: "O que é mais importante dentre todas as alternativas?", tipo: "text",
                opcoes: [
                    { label: "A", text: "Ser elegante", estilo: "clássica" },
                    { label: "B", text: "Ser prática", estilo: "tradicional" },
                    { label: "C", text: "Ser moderna", estilo: "dramática" },
                    { label: "D", text: "Ser feminina", estilo: "romântica" },
                    { label: "E", text: "Ser atraente", estilo: "sensual (sexy)" },
                    { label: "F", text: "Ser fashion", estilo: "criativa" },
                    { label: "G", text: "Ser confortável", estilo: "básica" }
                ]
            },
            { numero: 4, texto: "Para combinar com <strong>jeans e camiseta básica</strong>, o que é mais a sua cara?", tipo: "text",
                opcoes: [
                    { label: "A", text: "Um blazer acinturado bege com botões dourados", estilo: "clássica" },
                    { label: "B", text: "Um blazer reto, risca de giz marinho", estilo: "tradicional" },
                    { label: "C", text: "Um blazer oversized com ombreiras", estilo: "dramática" },
                    { label: "D", text: "Um casaquinho de tweed rosa", estilo: "romântica" },
                    { label: "E", text: "Um casaco de pelos vinho", estilo: "sensual (sexy)" },
                    { label: "F", text: "Um kimono de veludo bordado com paetês coloridos", estilo: "criativa" },
                    { label: "G", text: "Uma jaqueta de couro preta", estilo: "básica" }
                ]
            },
            { numero: 5, texto: "Qual frase mais combina com o seu jeito de se vestir no dia-a-dia?", tipo: "text",
                opcoes: [
                    { label: "A", text: `“É possível ser feminina e formal ao mesmo tempo.”`, estilo: "clássica" },
                    { label: "B", text: `“Discrição é o último grau de sofisticação.”`, estilo: "tradicional" },
                    { label: "C", text: `“Amo causar impacto sem dizer uma palavra.”`, estilo: "dramática" },
                    { label: "D", text: `“Me visto para expressar minha feminilidade.”`, estilo: "romântica" },
                    { label: "E", text: `“Quero me sentir poderosa e desejada.”`, estilo: "sensual (sexy)" },
                    { label: "F", text: `“Amo brincar com combinações inusitadas.”`, estilo: "criativa" },
                    { label: "G", text: `“Me visto com praticidade e zero frescura.”`, estilo: "básica" }
                ]
            },
            { numero: 6, texto: "Qual é o melhor elogio sobre o seu look?", tipo: "text",
                opcoes: [
                    { label: "A", text: `“Você está chiquíssima.”`, estilo: "clássica" },
                    { label: "B", text: `“Você está simples e elegante.”`, estilo: "tradicional" },
                    { label: "C", text: `“Você está moderna e impactante.”`, estilo: "dramática" },
                    { label: "D", text: `“Você está tão delicada e feminina!”`, estilo: "romântica" },
                    { label: "E", text: `“Você está incrível e irresistível.”`, estilo: "sensual (sexy)" },
                    { label: "F", text: `“Você está diferente de todos e criativa!”`, estilo: "criativa" },
                    { label: "G", text: `“Você parece tão confortável e natural!”`, estilo: "básica" }
                ]
            },
            { numero: 7, texto: "Considerando o mesmo preço e qualidade, qual estilo de loja te atrai mais:", tipo: "text",
                opcoes: [
                    { label: "A", text: "Uma loja de peças clássicas com toque de feminilidade.", estilo: "clássica" },
                    { label: "B", text: "Uma loja de peças clássicas e confortáveis.", estilo: "tradicional" },
                    { label: "C", text: "Uma loja de peças clássicas misturada com peças de impacto.", estilo: "dramática" },
                    { label: "D", text: "Uma loja de peças leves, com ar delicado e feminino.", estilo: "romântica" },
                    { label: "E", text: "Uma loja de peças elegantes e sensuais ao mesmo tempo.", estilo: "sensual (sexy)" },
                    { label: "F", text: "Uma loja com tendencias, e todos os tipos de estilo.", estilo: "criativa" },
                    { label: "G", text: "Uma loja com peças básicas, confortáveis, sem modismos.", estilo: "básica" }
                ]
            },
            { numero: 8, texto: "Qual frase define melhor a sua relação com as <strong>tendências</strong>?", tipo: "text",
                opcoes: [
                    { label: "A", text: "Prefiro peças clássicas e atemporais, assim vou me sentir sempre elegante.", estilo: "clássica" },
                    { label: "B", text: "Acho chato essa coisa da moda ficar mudando, prefiro estar sempre igual, assim não erro e ganho mais tempo.", estilo: "tradicional" },
                    { label: "C", text: "Gosto de algumas tendências, mas sempre misturo com clássicos.", estilo: "dramática" },
                    { label: "D", text: "Gosto de tendências que realçam meu lado feminino de uma forma delicada.", estilo: "romântica" },
                    { label: "E", text: "Gosto de tendências que realçam meu lado feminino de uma forma mais poderosa.", estilo: "sensual (sexy)" },
                    { label: "F", text: "Estou sempre testando tudo que é novo, adoro ousar e me divirto fazendo isso.", estilo: "criativa" },
                    { label: "G", text: "Não tenho paciência para acompanhar tendências, gosto de roupas confortáveis e fáceis.", estilo: "básica" }
                ]
            },
            { numero: 9, texto: "Qual destas situações te faria repensar uma roupa?", tipo: "text",
                opcoes: [
                    { label: "A", text: "Parecer informal demais.", estilo: "clássica" },
                    { label: "B", text: "Sentir que a roupa me deixou muito doce.", estilo: "tradicional" },
                    { label: "C", text: "Ficar apagada ou sem destaque.", estilo: "dramática" },
                    { label: "D", text: "Sentir que a roupa endureceu sua imagem.", estilo: "romântica" },
                    { label: "E", text: "Sentir que a roupa não valoriza seu corpo.", estilo: "sensual (sexy)" },
                    { label: "F", text: "Achar que está comum demais", estilo: "criativa" },
                    { label: "G", text: "Sentir que está chamando atenção demais.", estilo: "básica" }
                ]
            },
            { numero: 10, texto: "Qual reação você mais gostaria de ouvir a respeito do seu look?", tipo: "text",
                opcoes: [
                    { label: "A", text: `“Você é sempre elegante e sofisticada!”`, estilo: "clássica" },
                    { label: "B", text: `“Você é sempre elegante e transmite força!”`, estilo: "tradicional" },
                    { label: "C", text: `“Uau, como você tem presença!”`, estilo: "dramática" },
                    { label: "D", text: `“Que fofa, você está muito linda!”`, estilo: "romântica" },
                    { label: "E", text: `“Que linda, você tem um magnetismo natural!”`, estilo: "sensual (sexy)" },
                    { label: "F", text: `“Você é a mais estilosa!”`, estilo: "criativa" },
                    { label: "G", text: `“Você é natural e chique de uma forma simples.”`, estilo: "básica" }
                ]
            },
            { numero: 11, texto: "Ao entrar em uma loja para olhar as novidades, você:", tipo: "text",
                opcoes: [
                    { label: "A", text: `Vai direto na sessão de peças clássicas e femininas.`, estilo: "clássica" },
                    { label: "B", text: `Vai direto na sessão de peças clássicas e cortes mais retos, sem "firula”.`, estilo: "tradicional" },
                    { label: "C", text: `Vai na sessão dos clássicos mas sempre olha as versões mais modernas deles.`, estilo: "dramática" },
                    { label: "D", text: `Vai na sessão de  peças com mais movimento e com ar delicado e feminino.`, estilo: "romântica" },
                    { label: "E", text: `Vai atrás de peças que tenham sensualidade, que são femininas de um jeito mais poderoso.`, estilo: "sensual (sexy)" },
                    { label: "F", text: `Vai direto na arara de tendências pra conhecer tudo que saiu de mais recente.`, estilo: "criativa" },
                    { label: "G", text: `Busca peças práticas, confortáveis e que deixam arrumada em precisar de fazer tanto esforço...`, estilo: "básica" }
                ]
            },
            { numero: 12, texto: "O que você prefere parecer:", tipo: "text",
                opcoes: [
                    { label: "A", text: "Polida e uma verdadeira dama", estilo: "clássica" },
                    { label: "B", text: "Reservada, racional e eficiente", estilo: "tradicional" },
                    { label: "C", text: "Interessante, contemporânea e poderosa", estilo: "dramática" },
                    { label: "D", text: "Feminina, familiar e cuidadosa", estilo: "romântica" },
                    { label: "E", text: "Feminina, poderosa e magnética", estilo: "sensual (sexy)" },
                    { label: "F", text: "Ousada, expansiva e divertida", estilo: "criativa" },
                    { label: "G", text: "Simples, natural e elegante sem nenhum excesso", estilo: "básica" }
                ]
            },
            { numero: 13, texto: "Se você fosse um sapato, você seria:", tipo: "text",
                opcoes: [
                    { label: "A", text: "Um scarpin de bico fino", estilo: "clássica" },
                    { label: "B", text: "Um mocassim", estilo: "tradicional" },
                    { label: "C", text: "Uma sandália impactante", estilo: "dramática" },
                    { label: "D", text: "Uma sapatilha", estilo: "romântica" },
                    { label: "E", text: "Uma sandália de salto agulha e apenas duas tiras", estilo: "sensual (sexy)" },
                    { label: "F", text: "Um sapato colorido e que ninguém tem", estilo: "criativa" },
                    { label: "G", text: "Uma rasteira fácil de calçar", estilo: "básica" }
                ]
            },
            { numero: 14, texto: "Qual das afirmações mais se aproxima de você?", tipo: "text",
                opcoes: [
                    { label: "A", text: "Gosto de roupas clássicas porque gosto de estar sempre bem vestida e refinada", estilo: "clássica" },
                    { label: "B", text: "Gosto de roupas clássicas porque gosto de estar bem vestida de forma prática", estilo: "tradicional" },
                    { label: "C", text: "Gosto de roupas clássicas mas mas também me interesso por elementos criativos e modernos", estilo: "dramática" },
                    { label: "D", text: "Gosto de roupas que tenham romantismo e feminilidade", estilo: "romântica" },
                    { label: "E", text: "Gosto de roupas que sejam sensuais mas que não sejam vulgares", estilo: "sensual (sexy)" },
                    { label: "F", text: "Gosto de roupas diferentes e criativas, amo experimentar um pouco de tudo", estilo: "criativa" },
                    { label: "G", text: "Gosto de roupas fáceis, simples e que eu não pareça muito montada", estilo: "básica" }
                ]
            },
            { numero: 15, texto: "Qual look tem mais a sua cara?", tipo: "image" },
            { numero: 16, texto: "Qual brinco de pérola que tem mais a sua cara?", tipo: "image" },
            { numero: 17, texto: "Qual vestido tem mais a sua cara?", tipo: "image" },
            { numero: 18, texto: "Qual camisa tem mais a sua cara?", tipo: "image" },
            { numero: 19, texto: "Qual calça tem mais a sua cara?", tipo: "image" },
            { numero: 20, texto: "Qual saia tem mais a sua cara?", tipo: "image" },
            { numero: 21, texto: "Com qual look você iria em um <strong>jantar romântico</strong> em um restaurante elegante:", tipo: "image" },
            { numero: 22, texto: "Para compor um look básico com <strong>jeans e camiseta</strong>, qual tênis você escolheria:", tipo: "image" },
            { numero: 23, texto: "Qual sandália tem mais a sua cara?", tipo: "image" },
            { numero: 24, texto: "Qual sapato tem mais a sua cara?", tipo: "image" },
            { numero: 25, texto: "Qual grupo de estampas você olha e <strong>imediatamente já gosta</strong> mais?", tipo: "image" },
            { numero: 26, texto: "Qual bolsa tem mais a sua cara?", tipo: "image" },
            { numero: 27, texto: "Qual óculos tem mais a sua cara?", tipo: "image" },
            { numero: 28, texto: "Qual look você usaria para um <strong>baile de gala</strong>?", tipo: "image" },
            { numero: 29, texto: "Todos estes looks tem a <strong>mesma base</strong>, mas os <strong>acessórios</strong> e a <strong>modelagem</strong> das roupas <strong>variam</strong>. Qual deles é mais a sua cara?", tipo: "image" },
            { numero: 30, texto: "Qual relógio é mais a sua cara?", tipo: "image" },
            { numero: 31, texto: "Se tivesse que usar esse <strong>vestido</strong>, como usaria?", tipo: "image" },
            { numero: 32, texto: "Se tivesse que usar essa <strong>calça de paetês prateados</strong>, como usaria?", tipo: "image" },
            { numero: 33, texto: "Se tivesse que usar essa <strong>mini saia de couro</strong>, como usaria?", tipo: "image" },
            { numero: 34, texto: "Se tivesse que usar essa <strong>camiseta básica branca</strong>, como usaria?", tipo: "image" },
            { numero: 35, texto: "Se tivesse que usar esta <strong>camisa</strong>, como usaria?", tipo: "image" }
        ];
        // Popula opções de imagem
        for (let i = 14; i < totalPerguntas; i++) 
            {
                const q = todasAsPerguntas[i];
            
                if (q.tipo === 'image') 
                  {
                    const [startImg, endImg] = imagemRanges[q.numero];
                    q.opcoes = [];
                    for (let imgNum = startImg, j = 0; imgNum <= endImg; imgNum++, j++) 
                        { 
                         if (todosOsEstilos[j]) 
                            { q.opcoes.push({ label: labelsOpcoes[j], image: `imagens/${imgNum}.png`, estilo: todosOsEstilos[j] });
                              todasAsPerguntas.forEach(q => {
                                if (q.tipo === 'text') {
                                    q.opcoes.forEach(o => {o.textExibicao = o.text.replace(/\s*\([^)]*\)\s*$/, '').trim();});
                                   }
                                });
                            }
                        }
                  }
            }
    }

    // Inicia o quiz assim que a página carrega 
    window.addEventListener('load', initQuiz);
    

    // fallback: garante que o clique em #btn-download-pdf funcione mesmo se a tela final for exibida sem passar por displayFinalResults()
    document.addEventListener('click', function (ev) {
    const btn = ev.target.closest && ev.target.closest('#btn-download-pdf');
    if (!btn) return;
    ev.preventDefault();
    // chama o handler existente se houver
    if (typeof generatePdfAndSaveData  === 'function') {
        try { generatePdfAndSaveData (); } catch (e) { console.error('generatePdfAndSaveData  erro (fallback):', e); }
        return;
    }
    // fallback direto caso generatePdfAndSaveData  não exista por algum motivo
    (async () => {
        const finalEl = document.getElementById('final-resultado');
        if (!finalEl) { alert('Elemento final não encontrado'); return; }
        try {
        if (typeof generatePdfAndSaveData === 'function') {
            const blob = await generatePdfBlobFromElement(finalEl);
            downloadPdfBlob(blob, `Resultado_ArmarioPerfeito_${new Date().toISOString().slice(0,10)}.pdf`);
        } else {
            generatePdfAndSaveData (finalEl);
        }
        } catch (err) {
        console.error('Fallback geração PDF erro:', err);
        try { generatePdfAndSaveData (finalEl); } catch(e){ alert('Falha ao gerar PDF. Veja console.'); }
        }
    })();
    });



    // Expondo funções globais para funcionar com type="module"
    window.nextIntroPage = nextIntroPage;
    window.prevIntroPage = prevIntroPage;
    window.startQuiz = startQuiz;
    window.proceedToNextStep = proceedToNextStep;
    window.avancarParaProximaPergunta = avancarParaProximaPergunta;
    window.handleAnswerSelection = handleAnswerSelection;
    window.renderQuestion = renderQuestion;
    window.voltarPergunta = voltarPergunta;

    // INSERIDO EM 05/08
    // Cabeçalho some ao rolar para baixo e volta ao rolar para cima
    let lastScrollY = window.pageYOffset;
    window.addEventListener('scroll', () => {
        const header = document.querySelector('.sticky-header');
        const currentScrollY = window.pageYOffset;

        if (currentScrollY > lastScrollY) {
            // rolando para baixo → esconde
            header.classList.add('hidden');
            } else {
                // rolando para cima → mostra
                header.classList.remove('hidden');
        }

        lastScrollY = currentScrollY;
    });


        /* ---------- NEW: send modal + client PDF generation + upload ---------- */

    const sendModalEl = document.getElementById('send-result-modal');
    const sendModal = sendModalEl ? new bootstrap.Modal(sendModalEl) : null;

    function openSendModalPrefill() {
        const nameInput = document.getElementById('sendName');
        const emailInput = document.getElementById('sendEmail');
        // preenche se já existir em sessionStorage
        if (sessionStorage.getItem('ap_name')) nameInput.value = sessionStorage.getItem('ap_name');
        if (sessionStorage.getItem('ap_email')) emailInput.value = sessionStorage.getItem('ap_email');
        sendModal.show();
    }

// --- ANEXAR HANDLER MINIMAL E SEGURO para #btnGenerateAndSend ---
(function () {
    const btn = document.getElementById('btnGenerateAndSend');
    const sendModalEl = document.getElementById('send-result-modal');
    if (!btn || !sendModalEl) return; // evita erro se HTML diferente

    // evita múltiplas ligações se o script for executado outra vez
    if (btn.dataset.listenerAttached === '1') return;
    btn.dataset.listenerAttached = '1';

    btn.addEventListener('click', async function (ev) {
        ev.preventDefault();
        ev.stopPropagation();

        const nameInput = document.getElementById('sendName');
        const emailInput = document.getElementById('sendEmail');
        const feedback = document.getElementById('sendFeedback');

        const name = (nameInput && nameInput.value || '').trim();
        const email = (emailInput && emailInput.value || '').trim();

        if (!name || !email) {
            if (feedback) feedback.textContent = 'Por favor preencha nome e e-mail.';
            return;
        }
        if (feedback) feedback.textContent = 'Gerando PDF...';

        try {
            sessionStorage.setItem('ap_name', name);
            sessionStorage.setItem('ap_email', email);
        } catch (e) { /* ignore */ }

        // fecha o modal (tenta instâncias possíveis)
        try {
            if (window.sendModal && typeof window.sendModal.hide === 'function') {
                window.sendModal.hide();
            } else if (typeof sendModal !== 'undefined' && sendModal && typeof sendModal.hide === 'function') {
                sendModal.hide();
            } else {
                const bs = bootstrap && bootstrap.Modal ? bootstrap.Modal.getInstance(sendModalEl) : null;
                if (bs && typeof bs.hide === 'function') bs.hide();
            }
        } catch (e) { /* ignore */ }


        // --- substituir o setTimeout(...) por isso ---
        try {
        // garante que nada esteja focado (evita aria-hidden em elemento com foco)
        try { if (document.activeElement && document.activeElement.blur) document.activeElement.blur(); } catch(e){}

        // se temos instancia do modal do bootstrap, aguarda evento 'hidden.bs.modal'
        await new Promise(resolve => {
            const bsInstance = (window.bootstrap && bootstrap.Modal) ? bootstrap.Modal.getInstance(sendModalEl) : null;
            if (bsInstance && sendModalEl) {
            // se já está escondido, resolve imediatamente
            if (sendModalEl.classList.contains('show') === false) return resolve();
            sendModalEl.addEventListener('hidden.bs.modal', () => resolve(), { once: true });
            try { bsInstance.hide(); } catch(e){ /* ignore */ }
            // timeout de segurança caso o evento não dispare (fallback)
            setTimeout(resolve, 800);
            } else {
            // fallback genérico: espera uma animação curta
            setTimeout(resolve, 450);
            }
        });

        // aguarda fontes web carregarem (evita texto sem formatação)
        if (document.fonts && document.fonts.ready) {
            try { await document.fonts.ready; } catch(e){ /* ignore */ }
        }

        // aguarda logo e imagens essenciais (função existe no arquivo)
        try { await waitForLogo(3000); } catch(e){ /* ignore */ }

        // agora chama a rotina de geração com maior chance de estilos aplicados
        if (typeof generatePdfAndSaveData === 'function') {
            await generatePdfAndSaveData();
        } else {
            // fallback existente...
        }
        } catch (err) {
        console.error('Erro ao gerar/enviar PDF:', err);
        if (feedback) feedback.textContent = 'Erro ao gerar PDF. Veja console.';
        }


    }, { passive: false });
})();

// --- ANEXAR HANDLER MINIMAL E SEGURO para #btnGenerateAndSend ---
(function () {
    const btn = document.getElementById('btnGenerateAndSend');
    const sendModalEl = document.getElementById('send-result-modal');
    if (!btn || !sendModalEl) return; // evita erro se HTML diferente

    // evita múltiplas ligações se o script for executado outra vez
    if (btn.dataset.listenerAttached === '1') return;
    btn.dataset.listenerAttached = '1';

    btn.addEventListener('click', async function (ev) {
        ev.preventDefault();
        ev.stopPropagation();

        const nameInput = document.getElementById('sendName');
        const emailInput = document.getElementById('sendEmail');
        const feedback = document.getElementById('sendFeedback');

        const name = (nameInput && nameInput.value || '').trim();
        const email = (emailInput && emailInput.value || '').trim();

        if (!name || !email) {
            if (feedback) feedback.textContent = 'Por favor preencha nome e e-mail.';
            return;
        }
        if (feedback) feedback.textContent = 'Gerando PDF...';

        try {
            sessionStorage.setItem('ap_name', name);
            sessionStorage.setItem('ap_email', email);
        } catch (e) { /* ignore */ }

        // fecha o modal (tenta instâncias possíveis)
        try {
            if (window.sendModal && typeof window.sendModal.hide === 'function') {
                window.sendModal.hide();
            } else if (typeof sendModal !== 'undefined' && sendModal && typeof sendModal.hide === 'function') {
                sendModal.hide();
            } else {
                const bs = bootstrap && bootstrap.Modal ? bootstrap.Modal.getInstance(sendModalEl) : null;
                if (bs && typeof bs.hide === 'function') bs.hide();
            }
        } catch (e) { /* ignore */ }
    }, { passive: false });
})();


    // Aguarda a logo estar carregada (evita PDF sem a imagem)
    const waitForLogo = (timeout = 3000) => {
        const imgs = Array.from(document.querySelectorAll('img.logo-topo'));
        if (imgs.length === 0) return Promise.resolve();
        return Promise.all(imgs.map(img => {
            return new Promise(res => {
                if (img.complete) return res();
                img.addEventListener('load', () => res(), { once: true });
                img.addEventListener('error', () => res(), { once: true });
                // fallback timeout
                setTimeout(res, timeout);
            });
        }));
    };

// Exemplo de uso (movido para função; NÃO executa automaticamente)
// Para usar manualmente (por exemplo no console): exampleGeneratePdfAfterDelay(3000);
function exampleGeneratePdfAfterDelay(delay = 3000) {
    // não chama nada até que você invoque explicitamente esta função
    return waitForLogo(delay).then(async () => {
        try {
            const el = document.getElementById('final-resultado');
            if (!el) {
                console.info('exampleGeneratePdfAfterDelay: elemento #final-resultado não encontrado — nada a fazer.');
                return;
            }
            if (typeof generatePdfAndSaveData !== 'function') {
                console.info('exampleGeneratePdfAfterDelay: generatePdfAndSaveData não definida — nada a fazer.');
                return;
            }
            // chama de forma segura e aguarda; erros capturados para não quebrar nada
            await generatePdfBlobFromElement(el);
        } catch (err) {
            console.warn('exampleGeneratePdfAfterDelay: falha capturada (ignorada):', err);
        }
    }).catch(err => {
        // se waitForLogo rejeitar, apenas logue e continue — NÃO interrompe o app
        console.warn('exampleGeneratePdfAfterDelay: waitForLogo rejeitou (ignorado):', err);
    });
}
    // --- FUNÇÃO PRINCIPAL PARA GERAR PDF E ENVIAR DADOS PARA A PLANILHA ---
    async function generatePdfAndSaveData() {
        // Primeiro, calcule as dimensões da logo
        await calculateLogoDimensions();
        
        const finalResultEl = document.getElementById('final-resultado');
        if (!finalResultEl) {
            console.error('Elemento #final-resultado não encontrado no DOM');
            return; // Ou trate o erro de outra forma
        }

        // Adicione AQUI o delay para garantir renderização
        await new Promise(resolve => setTimeout(resolve, 2000)); // Pequeno delay para garantir renderização

        // Coleta os dados do usuário e resultados do teste
        const nome = sessionStorage.getItem('ap_name') || 'Nome não informado';
        const email = sessionStorage.getItem('ap_email') || 'email@exemplo.com';

        const estiloPrimario = estilosPrimarioSecundario.primary ? estilosPrimarioSecundario.primary.toUpperCase() : 'NÃO DEFINIDO';
        const estiloSecundario = estilosPrimarioSecundario.secondary ? estilosPrimarioSecundario.secondary.toUpperCase() : 'NÃO DEFINIDO';
        const estiloTerciario = estilosPrimarioSecundario.tertiary ? estilosPrimarioSecundario.tertiary.toUpperCase() : 'NÃO DEFINIDO';

        const currentDateTime = new Date();
        const dataFormatadaParaPDF = currentDateTime.toLocaleDateString('pt-BR');
        const dataFormatadaParaSheet = formatDateTimeForSheets(currentDateTime);
        const dateDDMMAA = getFormattedDateDDMMAA(currentDateTime); 

        // 1. Envia os dados para a planilha via Google Apps Script (usando GET com Image())
        // <<< COLOQUE A URL DO SEU APPS SCRIPT IMPLANTADO AQUI (COPIADA NO PASSO 1.3) >>>
        const gasWebAppLink = 'https://script.google.com/macros/s/AKfycbxF3vXT7x00ANhEZlrgTnfRRsJhb5iPOwlOvzhwI_joUIy4HZ-qOy8fVwbJlCLcDNOvdA/exec'; 
        
        const gasParams = new URLSearchParams({
            nome: nome,
            email: email,
            primario: estiloPrimario,
            secundario: estiloSecundario,
            terciario: estiloTerciario,
            data: dataFormatadaParaSheet,
            _t: Date.now() // Cache-buster
        }).toString();
        const gasUrl = gasWebAppLink + '?' + gasParams;

        console.log("Dados para enviar para a planilha via GET:", { nome, email, primario: estiloPrimario, secundario: estiloSecundario, terciario: estiloTerciario, data: dataFormatadaParaSheet });

        try {
            const img = new Image();
            img.src = gasUrl;
            img.onload = () => console.log('Envio para planilha (GET) concluído com sucesso.');
            img.onerror = (err) => {
                console.error('Erro ao enviar para planilha (GET):', err);
                alert('Falha ao enviar dados para a planilha. Por favor, verifique o console para mais detalhes ou tente novamente.');
            };
        } catch (error) {
            console.error('Erro ao iniciar envio para a planilha (Image GET):', error);
            alert('Erro interno ao tentar enviar dados para a planilha.');
        }

        // 2. Geração do PDF usando jsPDF e html2canvas
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');

        // A. Adiciona a Logo no topo com dimensões calculadas
        if (LOGO_BASE64 && LOGO_BASE64.startsWith('data:image')) {
            doc.addImage(LOGO_BASE64, 'PNG', LOGO_X_MM, LOGO_Y_MM, LOGO_DESIRED_WIDTH_MM, LOGO_CALCULATED_HEIGHT_MM);
        } else {
            console.warn('LOGO_BASE64 não definida ou inválida. Logo não será adicionada ao PDF.');
        }

        // B. Adiciona Nome, E-mail e Data abaixo da logo
        const textStartY = LOGO_Y_MM + LOGO_CALCULATED_HEIGHT_MM + 4; // 4mm de margem abaixo da logo
        doc.setFontSize(8); // Fonte ainda menor para metadata
        doc.setFont('helvetica', 'normal');
        doc.text(`Nome: ${nome}`, 10, textStartY); // Margem esquerda 15mm
        doc.text(`E-mail: ${email}`, 10, textStartY + 3.5); // 3.5mm abaixo do nome
        doc.text(`Data: ${dataFormatadaParaPDF}`, 10, textStartY + 7); // 3.5mm abaixo do email

        // C. Adiciona o conteúdo principal do diagnóstico (o que está no #final-resultado)
        
        if (finalResultEl) {
            // Calcula a posição Y onde o conteúdo renderizado deve começar NA MESMA PÁGINA
            const contentStartY_mm = textStartY + 7 + 4; // 4mm de espaço após a data
            const pageHeight = doc.internal.pageSize.height; // Altura total da página A4
            const pdfContentMarginX = 8; // Margem horizontal para o conteúdo do PDF
            
            // ALTERAÇÃO 2025-09-26: garantir que #final-resultado esteja visível para a captura
            let resetVisibility = null;
            try {
                const styleBefore = finalResultEl.getAttribute('style') || '';
                if (!finalResultEl.offsetParent || finalResultEl.offsetWidth === 0 || finalResultEl.offsetHeight === 0) {
                    finalResultEl.style.setProperty('display', 'block', 'important');
                    finalResultEl.style.setProperty('visibility', 'visible', 'important');
                    finalResultEl.style.setProperty('opacity', '1', 'important');

                    // Força reflow imediato após visibilidade
                    void finalResultEl.offsetHeight;
                    // Delay curto para browser aplicar fontes/estilos (requestAnimationFrame > setTimeout para sync com render)
                    await new Promise(resolve => requestAnimationFrame(resolve));
                    await new Promise(resolve => setTimeout(resolve, 2000)); // Ajuste para 800 se ainda falhar; >500 não resolveu sozinho, mas com reflow sim

                    resetVisibility = styleBefore;
                }
            } catch(e) { console.warn('checagem de visibilidade falhou:', e); }

            // antes do html2canvas(...)
            try { await waitForLogo(3000); } catch(e){}
            
            // Forçar reflow leve
            try { void finalResultEl.offsetHeight; } catch(e){}
        

            // Aguarda webfonts carregarem (só adicionar 1 linha antes de html2canvas) 15:40
            if (document.fonts && document.fonts.ready) await Promise.race([document.fonts.ready, new Promise(r=>setTimeout(r,8000))]);

            // Checagem extra: se fonts não loaded após wait, loga warn mas prossegue
            if (document.fonts && document.fonts.status !== 'loaded') {
                console.warn('Fonts não fully loaded após wait; prosseguindo com possíveis defaults.');
            }

            // Se o conteúdo da logo e metadata ocuparem mais da metade da página, talvez seja melhor
            await html2canvas(finalResultEl, {
                // Aumentamos a escala para 3.0 para texto muito mais nítido.
                // Isso terá um impacto no tamanho do arquivo, mas a legibilidade será excelente.
                scale: 3.0, // <-- ALTERADO de 1.1 para 3.0
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff',
                onclone: (clonedDoc) => customHtml2CanvasOnClone(clonedDoc, finalResultEl)
            }).then(canvas => {
              // Aumentamos a qualidade do JPEG para 0.8.
                // 0.8 é um bom equilíbrio entre qualidade e tamanho de arquivo para texto.
                const imgData = canvas.toDataURL('image/jpeg', 0.8); // <-- ALTERADO de 0.6 para 0.8
                const contentImgWidth = 210 - (pdfContentMarginX * 2);
                const contentImgHeight = canvas.height * contentImgWidth / canvas.width;
                // Verifica se o conteúdo renderizado (com as novas fontes e margens) caberá na página
                const remainingPageHeight = pageHeight - contentStartY_mm - 8; // 8mm de margem inferior
                
                if (contentImgHeight > remainingPageHeight) {
                    console.warn('Atenção: O conteúdo renderizado do diagnóstico ainda é muito grande e excederá uma única página, mesmo com as otimizações.');
                    // Se isso acontecer, você precisará otimizar mais o CSS para o PDF ou aceitar múltiplas páginas.
                }

                doc.addImage(imgData, 'JPEG', 15, contentStartY_mm, contentImgWidth, contentImgHeight); // Adiciona na mesma página
                
            }).catch(error => {
                console.error('Erro no html2canvas durante a renderização do conteúdo principal:', error);
                doc.text('Erro: Falha ao renderizar conteúdo do diagnóstico no PDF.', 15, contentStartY_mm + 10);
            });


            // restaura estilo original caso tenhamos alterado
            try { if (resetVisibility !== null) finalResultEl.setAttribute('style', resetVisibility); } catch(e){}


        } else {
            console.error('Elemento \'#final-resultado\' não encontrado para gerar o PDF. Verifique o ID.');
            doc.text('Erro: Conteúdo principal do diagnóstico não encontrado para geração do PDF.', 15, textStartY + 30);
        }

        // 3. Salva o PDF no navegador do usuário
        doc.save(`Diagnostico_Estilo_${dateDDMMAA}.pdf`); // <-- Linha alterada

        alert("PDF gerado e dados enviados para a planilha com sucesso!");
    }

    // Gera PDF do container #final-resultado em blob usando html2pdf (robusto)
    async function generatePdfBlobFromElement(element) {
        if (!element) throw new Error('Elemento final-resultado não encontrado');

        // garante que a lib esteja carregada
        await ensureHtml2pdf();

        // Gerar a data formatada aqui, antes de definir as opções do html2pdf
        const today = new Date();
        const dateDDMMAA = getFormattedDateDDMMAA(today); // <-- Nova linha para obter a data formatada

        // opções html2pdf/html2canvas

        // --- Ajuste dinâmico de scale para html2canvas (reduce em MOBILE)
        const __ap_is_mobile = /Mobi|Android/i.test(navigator.userAgent || '') || (window.innerWidth && window.innerWidth < 700);
        const __ap_dpr = Math.max(1, Math.min(window.devicePixelRatio || 1, 3));
        const __ap_default_scale = 3;
        const __ap_scale = __ap_is_mobile ? Math.max(1, Math.round((__ap_default_scale * 10 / __ap_dpr)) / 10) : __ap_default_scale;

        const opt = {
            margin:       [05, 8, 10, 8],
            filename:     `Diagnostico_Estilo_${dateDDMMAA}.pdf`, // <-- Linha alterada
            image:        { type: 'jpeg', quality: 0.95 },
            html2canvas:  { 
                scale: __ap_scale, // <-- ALTERADO de 2 para 3 para maior nitidez
                useCORS: true, 
                logging: false,
                // onclone sanitiza o documento clonado antes do html2canvas tentar parsear CSS
                onclone: (clonedDoc) => {

                    onclone: (document, element) => {
                        console.log('onclone chamado, elemento:', element);
                        if (!element) {
                            console.error('Elemento não recebido no onclone');
                            return;
                        }
                        // Resto do código de onclone
                    }


                    try {
                        // proteção: garante que o elemento original existe
                        if (typeof element === 'undefined' || !element) {
                            console.warn('onclone: elemento original (element) não encontrado — abortando sanitização do clone.');
                            return;
                        }
                        // pega lista de elementos do original e do clone na mesma ordem
                        const originals = element.querySelectorAll('*');
                        const clones = clonedDoc.querySelectorAll('*');

                        const len = Math.min(originals.length, clones.length);
                        for (let i = 0; i < len; i++) {
                            const o = originals[i];
                            const c = clones[i];
                            if (!o || !c) continue;

                            const cs = window.getComputedStyle(o);


                            // Dentro do loop onclone, logo após `const cs = window.getComputedStyle(o);`
                            try {
                            // propriedades de fonte / texto que devem ser preservadas
                            if (cs.fontFamily) c.style.fontFamily = cs.fontFamily;
                            if (cs.fontWeight) c.style.fontWeight = cs.fontWeight;
                            if (cs.fontStyle) c.style.fontStyle = cs.fontStyle;
                            if (cs.fontSize) c.style.fontSize = cs.fontSize;
                            if (cs.lineHeight) c.style.lineHeight = cs.lineHeight;
                            if (cs.letterSpacing) c.style.letterSpacing = cs.letterSpacing;
                            if (cs.wordSpacing) c.style.wordSpacing = cs.wordSpacing;
                            if (cs.textTransform) c.style.textTransform = cs.textTransform; // preserva UPPERCASE/LOWERCASE
                            if (cs.textDecoration) c.style.textDecoration = cs.textDecoration;
                            if (cs.textAlign) c.style.textAlign = cs.textAlign;
                            if (cs.whiteSpace) c.style.whiteSpace = cs.whiteSpace;
                            if (cs.direction) c.style.direction = cs.direction;

                            // Também força cor/weight quando houver
                            if (cs.color) c.style.color = cs.color;
                            if (cs.backgroundColor && cs.backgroundColor !== 'rgba(0, 0, 0, 0)') c.style.backgroundColor = cs.backgroundColor;
                            } catch(e){ /* ignore */ }


                            // força valores seguros (resolvidos pelo navegador)
                            if (cs.color) c.style.color = cs.color;
                            if (cs.backgroundColor && cs.backgroundColor !== 'rgba(0, 0, 0, 0)') {
                                c.style.backgroundColor = cs.backgroundColor;
                            } else {
                                c.style.backgroundColor = '#ffffff';
                            }

                            // desativa imagens/gradientes problemáticos no clone e aplica fallback
                            c.style.backgroundImage = 'none';
                            c.style.boxShadow = 'none';

                            // bordas e sombras
                            if (cs.borderColor) c.style.borderColor = cs.borderColor;

                            // remove filtros e propriedades que costumam quebrar o parser
                            c.style.filter = 'none';
                            c.style.backdropFilter = 'none';

                            // --- sanitize inline style text that can contain modern color functions ---
                            const inline = c.getAttribute && c.getAttribute('style');
                            if (inline && /(?:color-mix|color\(|lab\(|lch\()/i.test(inline)) {
                                try {
                                    c.setAttribute('style', inline.replace(/(?:color-mix\([^\)]*\)|color\([^\)]*\)|lab\([^\)]*\)|lch\([^\)]*\))/gi, ''));
                                } catch (e) { /* ignore per-element sanitize failures */ }
                            }
                        }

                        // --- sanitize <style> tags inside the cloned document (remove unsupported functions and page-breaks) ---
                        const styleTags = clonedDoc.querySelectorAll('style');
                        styleTags.forEach(st => {
                            try {
                                // remove modern color functions and any page-break rules that can create blank pages
                            st.textContent = st.textContent
                                .replace(/(?:color-mix\([^\)]*\)|color\([^\)]*\)|lab\([^\)]*\)|lch\([^\)]*\))/gi, '')
                                .replace(/page-break-(after|before):\s*always;?/gi, '')
                                .replace(/break-(after|before):\s*page;?/gi, '')
                                .replace(/@page[^{]*\{[^}]*\}/gi, '')              // remove regras @page
                                .replace(/break-inside:\s*avoid;?/gi, '')         // remove avoid breaks
                                .replace(/orphans:\s*\d+;?/gi, '')                // remove orphans
                                .replace(/widows:\s*\d+;?/gi, '');                // remove widows
                            } catch (e) { /* ignore */ }
                        });

                        // Remove external stylesheets from the clone head (to avoid complex rules)
                        const head = clonedDoc.querySelector('head');
                        if (head) {
                            head.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
                                try {
                                    const href = link.getAttribute('href') || '';
                                    // preserve arquivos de fontes/external font providers (ex: googleapis, gstatic, woff, woff2, ttf)
                                    if (/fonts\.googleapis|fonts\.gstatic|\.woff2?|\.ttf|\.otf/i.test(href)) {
                                        // mantém link para carregar fontes (essencial para medidas corretas)
                                        return;
                                    }
                                    // para outros estilos: em vez de remover, reduz seu impacto definindo media=print
                                    // isso tende a manter fontes carregadas, mas reduz re-parsing de regras que podem quebrar html2canvas
                                    try {
                                        link.media = 'print';
                                    } catch (e) {
                                        // fallback: se não conseguimos ajustar media, removemos
                                        link.remove();
                                    }
                                } catch (e) {
                                    // se algo falhar aqui, não interrompe o processo
                                    try { link.remove(); } catch (err) {}
                                }
                            });
                        }
                        // Remove the on-screen export controls (button) from the CLONE so they don't appear in the PDF
                        const hideSelectors = ['#btn-download-pdf', '#download-pdf', '.result-export-controls', '#btnGenerateAndSend'];
                        hideSelectors.forEach(sel => {
                            try {
                                clonedDoc.querySelectorAll(sel).forEach(n => n.remove());
                            } catch (e) { /* ignore */ }
                        });

                        // Inject a small safety style into the clone to avoid forced page-breaks or extra margins
                        try {
                            const safetyStyle = clonedDoc.createElement('style');
                            safetyStyle.textContent = `
                                /* Small adjustments only for the CLONE used to render PDF */
                                html, body { height: auto !important; overflow: visible !important; margin: 0; padding: 8px; }
                                body { font-size: 13px !important; line-height: 1.2 !important; color: #000 !important; }
                                /* Title styling fallback — se for h1/h2/p com esse texto, será maior via JS abaixo */
                                h1, h2, .final-title, .diagnostico-title { text-align: center !important; font-size: 16px !important; font-weight: 600 !important; margin-bottom: 12px !important; }
                                h1,h2,h3,h4 { page-break-after: avoid !important; break-after: avoid !important; }
                                p, ul, ol { page-break-inside: avoid !important; break-inside: avoid !important; }
                                img, img.logo, img.logo-topo, .logo { max-width: 160px !important; height: auto !important; display: block !important; }                                
                                .logo-topo { margin: 0 0 12px 0 !important; }
                                .result-export-controls, #btn-download-pdf, #download-pdf { display: none !important; }
                                * { box-sizing: border-box !important; -webkit-font-smoothing: antialiased !important; -moz-osx-font-smoothing: grayscale !important; }
                            `;
                            if (head) head.appendChild(safetyStyle);

                            // --- Ajustes finais no clone: centralizar título detectando o texto e destacar rótulos ---
                            try {
                                // centraliza e aumenta o título que contém "Diagnóstico de estilo finalizado"
                                const possibleTitle = Array.from(clonedDoc.querySelectorAll('h1,h2,h3,p,div')).find(n => /Diagn[áa]stico  de estilo finalizado/i.test(n.textContent));
                                if (possibleTitle) {
                                    possibleTitle.style.textAlign = 'center';
                                    // possibleTitle.style.fontSize = '18px'; // <-- REMOVIDO: Font size será controlada via safetyStyle
                                    possibleTitle.style.fontWeight = '600';
                                    possibleTitle.style.marginBottom = '12px';
                                }

                                // realçar rótulos "Estilo Primário", "Estilo Secundário", "Estilo Terciário"
                                ['Estilo Primário','Estilo Secundário','Estilo Terciário'].forEach(lbl => {
                                    const node = Array.from(clonedDoc.querySelectorAll('*')).find(n => new RegExp('\\b' + lbl.replace(/ /g,'\\s+') + '\\b','i').test(n.textContent || ''));
                                    if (node) {
                                        node.style.fontSize = '14px';
                                        node.style.fontWeight = '600';
                                        node.style.marginTop = '10px';
                                        node.style.marginBottom = '6px';
                                    }
                                });
                            } catch (e) { /* não quebra se falhar */ }
                        } catch (e) { /* ignore */ }

                        // Ensure cloned html/body have no background gradients or large paddings that push an extra page
                        const clonedHtml = clonedDoc.querySelector('html');
                        const clonedBody = clonedDoc.querySelector('body');
                        if (clonedHtml) {
                            clonedHtml.style.backgroundImage = 'none';
                            clonedHtml.style.backgroundColor = '#ffffff';
                            clonedHtml.style.height = 'auto';
                        }
                        if (clonedBody) {
                            clonedBody.style.backgroundImage = 'none';
                            clonedBody.style.backgroundColor = '#ffffff';
                            clonedBody.style.height = 'auto';
                            clonedBody.style.paddingBottom = '0px';
                            clonedBody.style.overflow = 'visible';
                        }
                        try {
                            const last = clonedBody && clonedBody.lastElementChild;
                            if (last && last.tagName === 'DIV' && last.textContent.trim().length === 0 && last.querySelectorAll('img').length === 0) {
                                last.remove();
                            }
                        } catch (e) { /* ignore */ }

                    } catch (e) {
                        // não falha o processo se algo inesperado acontecer aqui
                        console.warn('onclone sanitization error', e);
                    }

                    // --- INJETAR METADATA NO TOPO DO CLONE DO ELEMENTO ALVO (pos:absolute; top:8px) ---
                    try {
                        function _apEscapeHtml(str){
                            return (str||'').toString().replace(/[&<>"']/g, function(m){
                                return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
                            });
                        }
                        const _apName  = sessionStorage.getItem('ap_name') || '';
                        const _apEmail = sessionStorage.getItem('ap_email') || '';

                        if (_apName || _apEmail) {
                            // localizar clone do elemento alvo
                            let clonedTarget = null;
                            try {
                                if (element && element.id) clonedTarget = clonedDoc.getElementById(element.id);
                            } catch(e){ clonedTarget = null; }

                            if (!clonedTarget) {
                                try { clonedTarget = clonedDoc.querySelector('#final-resultado') || clonedDoc.body; } catch(e){ clonedTarget = clonedDoc.body; }
                            }

                            const attachTo = clonedTarget || clonedDoc.body || clonedDoc.documentElement;

                            // garantir posicionamento relativo para o absolute funcionar corretamente dentro do target
                            try { attachTo.style.position = attachTo.style.position || 'relative'; } catch(e){}

                            // inserir style mínimo no head do clone (opcional, reforça comportamento)
                            try {
                                const s = clonedDoc.createElement('style');
                                s.type = 'text/css';
                                s.appendChild(clonedDoc.createTextNode("\
                                    /* AP metadata styling (absolute top, não altera fluxo) */\n\
                                    #ap-pdf-metadata { position: absolute !important; left: 12px !important; right: 12px !important; top: 8px !important; font-size:11px !important; line-height:1.1 !important; color:#222 !important; text-align:left !important; z-index:99999 !important; background:transparent !important; padding:0 !important; margin:0 !important; }\n\
                                "));
                                if (clonedDoc.head) clonedDoc.head.appendChild(s); else attachTo.insertBefore(s, attachTo.firstChild);
                            } catch(e){ /* ignore */ }

                    // --- INJEÇÃO: ajuste específico para MOBILE (aplica-se ao documento CLONADO usado para html2canvas)
                    try {
                        const win = clonedDoc.defaultView || window;
                        const isMobileClone = /Mobi|Android/i.test(win.navigator.userAgent || '') || (win.innerWidth && win.innerWidth < 700);
                        if (isMobileClone && !clonedDoc.getElementById('ap-pdf-mobile-adjust')) {
                            const mstyle = clonedDoc.createElement('style');
                            mstyle.id = 'ap-pdf-mobile-adjust';
                            mstyle.appendChild(clonedDoc.createTextNode(`
                                /* Força redução de fontes apenas no clone para evitar quebras no PDF gerado a partir de MOBILE */
                                html, body { font-size: 11px !important; line-height: 1.08 !important; }
                                /* Reduz títulos grandes e display styles */
                                h1, h2, .final-title, .display-4, .big-title { font-size: 20px !important; line-height:1.06 !important; }
                                h3, h4, .sub-title { font-size: 14px !important; }
                                /* Ajustes finos de espaçamento e margens */
                                .section, .page-content-wrapper { margin-bottom: 6px !important; padding-bottom: 0 !important; }
                                /* Evita overflow de texto */
                                * { word-break: break-word !important; white-space: normal !important; overflow-wrap: break-word !important; }
                            `));
                            if (clonedDoc.head) clonedDoc.head.appendChild(mstyle);
                        }
                    } catch(e) { console.warn('ap-pdf-mobile-adjust failed', e); }


                            const meta = clonedDoc.createElement('div');
                            meta.id = 'ap-pdf-metadata';
                            meta.setAttribute('aria-hidden','true');
                            meta.setAttribute('style', [
                                'position:absolute',
                                'left:10px',
                                'right:10px',
                                'top:8px',
                                'font-size:11px',
                                'line-height:1.1',
                                'color:#222',
                                'text-align:left',
                                'z-index:99999',
                                'background:transparent',
                                'padding:0',
                                'margin:0'
                            ].join(';'));

                            const today = new Date();
                            const dateStr = today.toLocaleDateString();

                            meta.innerHTML = '<strong style="font-weight:600;margin-right:6px;">Nome:</strong>' + _apEscapeHtml(_apName) +
                                            ' &nbsp;&nbsp; <strong style="font-weight:600;margin-right:6px;">E-mail:</strong>' + _apEscapeHtml(_apEmail) +
                                            ' &nbsp;&nbsp; <strong style="font-weight:600;margin-right:6px;">Data:</strong>' + _apEscapeHtml(dateStr);

                            // inserir como FIRST CHILD do attachTo para garantir que esteja no topo do conteúdo renderizado
                            try { attachTo.insertBefore(meta, attachTo.firstChild); } catch(e){ try { clonedDoc.body.insertBefore(meta, clonedDoc.body.firstChild); } catch(ee){ console.warn('ap: append meta falhou', ee);} }

                            // DEBUG TEMP: expor HTML do clone target (pode remover depois)
                            try { window.__AP_LAST_CLONED_TARGET_HTML = (attachTo && attachTo.outerHTML) || null; } catch(e){}
                        }
                    } catch(e) {
                        console.warn('ap: falha ao inserir metadata top no clone (ignorado):', e);
                    }
                }
            },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        // --- AP: helpers para inserir/retirar metadata no elemento original DURANTE a geração ---
        function _apEscapeHtml(str){
            return (str||'').toString().replace(/[&<>"']/g, function(m){
                return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
            });
        }
        function attachMetadataToOriginal(elem){
            try {
                if (!elem) return null;
                const name = sessionStorage.getItem('ap_name') || '';
                const email = sessionStorage.getItem('ap_email') || '';
                if (!name && !email) return null;

                // guarda posição anterior para restaurar (só por precaução)
                const prevPos = elem.style && elem.style.position ? elem.style.position : '';

                try { if (!elem.style.position || elem.style.position === 'static') elem.style.position = 'relative'; } catch(e){}

                // criar elemento (não inserido ainda)
                const meta = document.createElement('div');

                // ---------- Configurável: quanto empurrar para baixo (em px) ----------
                // Aumente este valor para descer mais; diminua para subir.
                // Ex.: 40, 60, 100, 160 ... teste iterando.
                const marginTopPx = 10; // <-- ajuste este valor até ficar perfeito
                // --------------------------------------------------------------------

                // estilos como bloco (vai empurrar o conteúdo abaixo)
                meta.id = '__ap_injected_meta';
                meta.setAttribute('aria-hidden','true');
                meta.style.display = 'block';
                meta.style.width = '100%';
                meta.style.boxSizing = 'border-box';
                meta.style.marginTop = marginTopPx + 'px';
                meta.style.fontSize = '10px';
                meta.style.lineHeight = '1.1';
                meta.style.color = '#222';
                meta.style.textAlign = 'center'; 
                meta.style.zIndex = '99999';
                meta.style.background = 'transparent';
                meta.style.padding = '0';
                meta.style.marginLeft = '10px';
                meta.style.marginRight = '10px';

                const dateStr = (new Date()).toLocaleDateString();
                meta.innerHTML = '<strong style="font-weight:600;margin-right:6px;">Nome:</strong>' + _apEscapeHtml(name) +
                                ' &nbsp;&nbsp; <strong style="font-weight:600;margin-right:6px;">E-mail:</strong>' + _apEscapeHtml(email) +
                                ' &nbsp;&nbsp; <strong style="font-weight:600;margin-right:6px;">Data:</strong>' + _apEscapeHtml(dateStr);

                // inserir ANTES do cabeçalho (se existir) para DESCER todo o restante; fallback para firstChild
                try {
                    const hdr = elem.querySelector('.final-results-header');
                    // adiciona um pequeno espaçamento para separar visualmente do título
                    meta.style.marginTop = '0';
                    meta.style.marginBottom = '0'; // ajuste este valor para aumentar/diminuir o espaço
                    if (hdr && hdr.parentNode === elem) {
                        // inserir antes do header — empurra todo o conteúdo para baixo
                        elem.insertBefore(meta, hdr);
                    } else {
                        // fallback: inserir no topo do conteúdo
                        elem.insertBefore(meta, elem.firstChild);
                    }
                } catch (e) {
                    try { elem.insertBefore(meta, elem.firstChild); } catch(ee){ elem.appendChild(meta); }
                }

                return prevPos || null;
            } catch(e) { console.warn('attachMetadataToOriginal erro:', e); return null; }
        }


        function detachMetadataFromOriginal(elem, prevPos){
            try {
                if (!elem) return;
                const m = elem.querySelector('#__ap_injected_meta');
                if (m) try { m.remove(); } catch(e){ /* ignore */ }
                if (prevPos !== null && prevPos !== undefined) {
                    try { elem.style.position = prevPos || ''; } catch(e){}
                }
            } catch(e) { /* ignore */ }
        }

        // tenta o método moderno outputPdf('blob')
        try {
            if (window.html2pdf && typeof window.html2pdf === 'function' && typeof window.html2pdf().set === 'function' && typeof window.html2pdf().from === 'function') {
            // const blob = await window.html2pdf().set(opt).from(element).outputPdf('blob');

            // inserir metadata no original antes de chamar html2pdf, para garantir mapeamento clone <- original
            let __ap_prev_pos = null;
            try {
                __ap_prev_pos = attachMetadataToOriginal(element);
            } catch(e){ __ap_prev_pos = null; }

            try {
                const blob = await window.html2pdf().set(opt).from(element).outputPdf('blob');
                return blob;
            } finally {
                try { detachMetadataFromOriginal(element, __ap_prev_pos); } catch(e){ /* ignore */ }
            }


            return blob;
            }
        } catch (err) {
            console.warn('outputPdf falhou, tentando fallback...', err);
        }

        // fallback para versões antigas (0.9.x): gera e pega blob via Promise
        return await new Promise((resolve, reject) => {
            let __ap_prev_pos = null;
            try { __ap_prev_pos = attachMetadataToOriginal(element); } catch(e){ __ap_prev_pos = null; }

            try {
                window.html2pdf().set(opt).from(element).toPdf().output('blob', (blob) => {
                    try {
                        if (blob) resolve(blob);
                        else reject(new Error('Falha ao obter blob (fallback).'));
                    } finally {
                        try { detachMetadataFromOriginal(element, __ap_prev_pos); } catch(e){}
                    }
                });
            } catch (e) {
                try { detachMetadataFromOriginal(element, __ap_prev_pos); } catch(err){}
                reject(new Error('Erro ao gerar PDF (fallback): ' + e.message));
            }
        });

    }

    function downloadPdfBlob(pdfBlob, filename = 'resultado-armario-perfeito.pdf') {
    const url = URL.createObjectURL(pdfBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 2500);
    }


    /* --- Patch mínimo (append) para preservar fonts/text-transform antes do html2canvas
   Cole ESTE bloco EXATAMENTE no final do seu script.js (apenas append). 
   Ele não remove nem substitui handlers existentes: só "envolve" html2canvas.
/* --- Patch mínimo (append) para preservar fonts/text-transform antes do html2canvas
   Cole ESTE bloco EXATAMENTE no final do seu script.js (apenas append). 
   Ele não remove nem substitui handlers existentes: só "envolve" html2canvas.
*/

/* --- Patch mínimo (append) para preservar fonts/text-transform antes do html2canvas
   Cole ESTE bloco EXATAMENTE no final do seu script.js (apenas append). 
   Ele não remove nem substitui handlers existentes: só "envolve" html2canvas.
*/

/* --- Patch mínimo (append) para preservar fonts/text-transform antes do html2canvas
   Cole ESTE bloco EXATAMENTE no final do seu script.js (apenas append). 
   Ele não remove nem substitui handlers existentes: só "envolve" html2canvas.
*/
(function(){
  if (!window.html2canvas) {
    console.warn('Patch html2canvas: html2canvas não encontrado no momento da carga. Este patch tentará aplicar quando estiver disponível.');
    // tenta aplicar mais tarde se html2canvas for carregado depois
    const observer = new MutationObserver(() => {
      if (window.html2canvas) {
        observer.disconnect();
        applyHtml2canvasWrapper();
      }
    });
    observer.observe(document.head || document.documentElement, {childList: true, subtree: true});
  } else {
    applyHtml2canvasWrapper();
  }

  function applyHtml2canvasWrapper(){
    try {
      const _orig = window.html2canvas;
      if (_orig.__wrapped_by_patch) return; // evita aplicar duas vezes
      window.html2canvas = function(element, options){
        options = options || {};
        const userOnclone = options.onclone;

        // novo onclone que copia folhas de estilo e estilos críticos (text-transform, font, etc)
        options.onclone = function(clonedDoc){
          try {
            // 1) clonar <link rel="stylesheet"> e <style> para o head do clone (evita falta de Google Fonts/estilos)
            Array.from(document.querySelectorAll('link[rel="stylesheet"], style')).forEach(n => {
              try { clonedDoc.head.appendChild(n.cloneNode(true)); } catch(e){}
            });

            // 2) Função local para copiar styles críticos
            function copyCriticalStyles(src, tgt){
              try {
                const cs = window.getComputedStyle(src);
                if (!cs) return;
                const props = [
                  'font-family','font-weight','font-style','font-size','line-height',
                  'letter-spacing','word-spacing','text-transform','text-decoration',
                  'color','background-color','text-align','white-space','direction',
                  'text-rendering','-webkit-font-smoothing'
                ];
                props.forEach(p => {
                  try {
                    const v = cs.getPropertyValue(p) || cs[p.replace(/-([a-z])/g, (m,g)=>g.toUpperCase())];
                    if (v) tgt.style.setProperty(p, v, 'important');
                  } catch(e){}
                });
              } catch(e){}

                // Forçar font-size mínimo para elementos de texto
                if (['P','DIV','SPAN','LI','STRONG','B','EM','I'].includes(src.tagName)) {
                    tgt.style.setProperty('font-size', '11px', 'important');
                }
                if (['H1','H2','H3'].includes(src.tagName) || src.className.includes('final-title') || src.className.includes('diagnostico-title')) {
                    tgt.style.setProperty('font-size', '14px', 'important');
                }
                if (window.innerWidth < 768) {
                    tgt.style.setProperty('font-size', '10px', 'important'); /* Para texto no mobile */
                }
            }

            // 3) copiar estilos node-a-node entre o elemento original e o clone (heurística por índice)
            if (element && element.querySelectorAll) {
              const srcNodes = element.querySelectorAll('*');
              const tgtNodes = clonedDoc.querySelectorAll('*');
              const len = Math.min(srcNodes.length, tgtNodes.length);
              for (let i = 0; i < len; i++){
                try { copyCriticalStyles(srcNodes[i], tgtNodes[i]); } catch(e){}
              }
            }

            // === FORÇA: copia styles críticos do original para o clone e remove gradients incompatíveis === 15:40
            try {
              // detecta raiz original e raiz do clone
              const srcRoot = element; // Use 'element' (parâmetro passado para html2canvas), pois 'finalResultEl' é local e não disponível aqui
              const cloneRoot = clonedDoc.getElementById(srcRoot.id) ||
                                clonedDoc.querySelector(srcRoot.className?.split(' ')[0] ? '.'+srcRoot.className.split(' ')[0] : null) ||
                                clonedDoc.body;

              const srcNodes = srcRoot.querySelectorAll('*');
              const tgtNodes = cloneRoot ? cloneRoot.querySelectorAll('*') : clonedDoc.querySelectorAll('*');
              const len = Math.min(srcNodes.length, tgtNodes.length);

              const props = ['font-family','font-weight','font-style','font-size','line-height','letter-spacing','word-spacing','text-transform','color','background-color','text-align'];

              for (let i = 0; i < len; i++) {
                  try {
                  const s = srcNodes[i], t = tgtNodes[i];
                  const cs = window.getComputedStyle(s);

                  // copia propriedades críticas inline com !important
                  props.forEach(p => {
                      try {
                      const v = cs.getPropertyValue(p);
                      if (v) t.style.setProperty(p, v, 'important');
                      } catch(e){}
                  });

                  // se houver background-image com gradiente (possível uso de color() dentro), remova para evitar erro de parse
                  const bg = cs.getPropertyValue('background-image');
                  if (bg && bg !== 'none' && /gradient|color\(/i.test(bg)) {
                      t.style.setProperty('background-image', 'none', 'important');
                      // aplica background-color calculado como fallback
                      const bc = cs.getPropertyValue('background-color');
                      if (bc && bc !== 'rgba(0, 0, 0, 0)') t.style.setProperty('background-color', bc, 'important');
                  }
                  } catch(e){}
              }
            } catch(e){ console.warn('onclone: force-copy-styles failed', e); }

            // Ensure cloned html/body have no background gradients or large paddings that push an extra page
            const clonedHtml = clonedDoc.querySelector('html');
            const clonedBody = clonedDoc.querySelector('body');
            if (clonedHtml) {
                clonedHtml.style.backgroundImage = 'none';
                clonedHtml.style.backgroundColor = '#ffffff';
                clonedHtml.style.height = 'auto';
            }
            if (clonedBody) {
                clonedBody.style.backgroundImage = 'none';
                clonedBody.style.backgroundColor = '#ffffff';
                clonedBody.style.height = 'auto';
                clonedBody.style.paddingBottom = '0px';
                clonedBody.style.overflow = 'visible';
            }
            try {
                const last = clonedBody && clonedBody.lastElementChild;
                if (last && last.tagName === 'DIV' && last.textContent.trim().length === 0 && last.querySelectorAll('img').length === 0) {
                    last.remove();
                }
            } catch (e) { /* ignore */ }

            // Inject a small safety style into the clone to avoid forced page-breaks or extra margins
            try {
                const safetyStyle = clonedDoc.createElement('style');
                safetyStyle.textContent = `
                    /* Small adjustments only for the CLONE used to render PDF */
                    html, body { font-size: 15px !important; line-height: 1.5 !important; color: #000 !important; } 
                    p, div, span, li, strong, b, em, i { font-size: 14px !important; line-height: 1.5 !important; } 
                    h1, h2, .final-title, .diagnostico-title { text-align: center !important; font-size: 16px !important; font-weight: 600 !important; margin-bottom: 12px !important; } 
                    h1,h2,h3,h4 { page-break-after: avoid !important; break-after: avoid !important; }
                    p, ul, ol { page-break-inside: avoid !important; break-inside: avoid !important; }
                    img, img.logo, img.logo-topo, .logo { max-width: 160px !important; height: auto !important; display: block !important; }                                
                    .logo-topo { margin: 0 0 12px 0 !important; }
                    .result-export-controls, #btn-download-pdf, #download-pdf { display: none !important; }
                    * { box-sizing: border-box !important; -webkit-font-smoothing: antialiased !important; -moz-osx-font-smoothing: grayscale !important; }
                `;
                if (clonedDoc.head) clonedDoc.head.appendChild(safetyStyle);

                // --- Ajustes finais no clone: centralizar título detectando o texto e destacar rótulos ---
                try {
                    // centraliza e aumenta o título que contém "Diagnóstico de estilo finalizado"
                    const possibleTitle = Array.from(clonedDoc.querySelectorAll('h1,h2,h3,p,div')).find(n => /Diagn[áa]stico  de estilo finalizado/i.test(n.textContent));
                    if (possibleTitle) {
                        possibleTitle.style.textAlign = 'center';
                        possibleTitle.style.fontSize = '16px'; 
                        possibleTitle.style.fontWeight = '600';
                        possibleTitle.style.marginBottom = '6px';
                    }

                    // realçar rótulos "Estilo Primário", "Estilo Secundário", "Estilo Terciário"
                    ['Estilo Primário','Estilo Secundário','Estilo Terciário'].forEach(lbl => {
                        const node = Array.from(clonedDoc.querySelectorAll('*')).find(n => new RegExp('\\b' + lbl.replace(/ /g,'\\s+') + '\\b','i').test(n.textContent || ''));
                        if (node) {
                            node.style.fontSize = '16px'; 
                            node.style.fontWeight = '600';
                            node.style.marginTop = '10px';
                            node.style.marginBottom = '6px';
                        }
                    });
                } catch (e) { /* não quebra se falhar */ }
            } catch (e) { /* ignore */ }

            // inserir style mínimo no head do clone (opcional, reforça comportamento) para metadata
            try {
                const s = clonedDoc.createElement('style');
                s.type = 'text/css';
                s.appendChild(clonedDoc.createTextNode("\
                    /* AP metadata styling (absolute top, não altera fluxo) */\n\
                    #ap-pdf-metadata { position: absolute !important; left: 14px !important; right: 14px !important; top: 8px !important; font-size:14px !important; line-height:1.1 !important; color:#222 !important; text-align:left !important; z-index:99999 !important; background:transparent !important; padding:0 !important; margin:0 !important; } // ALTERADO PARA AUMENTAR FONTE\n\
                "));
                if (clonedDoc.head) clonedDoc.head.appendChild(s); else attachTo.insertBefore(s, attachTo.firstChild);
            } catch(e){ /* ignore */ }

          } catch(e){
            console.warn('Patch html2canvas: erro em onclone:', e);
          }

          if (typeof userOnclone === 'function') {
            try { userOnclone(clonedDoc); } catch(e){ console.warn('userOnclone falhou', e); }
          }
        };

        // Aguarda fonts (se existirem) antes de chamar a versão original.
        // Retornamos a Promise que html2canvas normalmente retorna.
        return (async function(){
          try {
            if (document.fonts && document.fonts.ready) {
              // timeout extra curto para evitar bloqueio indefinido (fallback 3s)
              const fontsPromise = document.fonts.ready;
              await Promise.race([fontsPromise, new Promise(r=>setTimeout(r, 30000))]); // ALTERADO PARA AUMENTAR TIMEOUT (de 8000 para 12000)
            }
            // também aguardamos imagens do element (curto) — evita capturar placeholders
            try {
              const imgs = element ? Array.from(element.querySelectorAll('img')) : [];
              await Promise.all(imgs.map(img => new Promise(res => {
                if (!img || img.complete) return res();
                img.addEventListener('load', ()=>res(), {once:true});
                img.addEventListener('error', ()=>res(), {once:true});
                // safety timeout
                setTimeout(res, 4000);
              })));
            } catch(e){}
          } catch(e){}
          return _orig(element, options);
        })();
      };
      window.html2canvas.__wrapped_by_patch = true;
      console.info('Patch html2canvas aplicado: onclone augmented + espera por fonts/images.');
    } catch (err) {
      console.error('Erro ao aplicar patch html2canvas:', err);
    }
  }
})();